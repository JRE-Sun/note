
<!DOCTYPE html>
<html>
  <!-- OriginalSrc: https://juejin.im/post/5c9826ac5188256d5328b9f6 -->
  <head>
    <meta http-equiv="Content-Type" content="text/html"; charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>html5录音功能实战@html5</title>
    
<link rel="stylesheet" href="assets/1553502781-1f9e0f727e6a99422a0a1f6e2139bd56.css">

<link rel="stylesheet" href="assets/1553502781-39cb236590c2d7f28116c42fb1c4858a.css">

<link href="assets/1553502781-8fb9abf610d00a83db96fdbd8f6dda9e.css" rel="stylesheet">
<style>
body {
        font-size: 16px;
        line-height: 2;
      }
      a, button, input {
        margin: 1rem 1.5rem;
      }
      img {
        width: 0;
        height: 0;
      }
      #juejin {
        overflow-x: hidden;
      }
</style>
<style>

html.cye-enabled.cye-nm:not(*:-webkit-full-screen) body,
 html.cye-enabled.cye-nm:not(*:-webkit-full-screen) #cye-workaround-body {-webkit-filter:contrast(91%) brightness(84%) invert(1);}
</style>
<style>
html.cye-enabled.cye-lm body{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>
html.cye-enabled.cye-lm div{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>
html.cye-enabled.cye-lm th{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}html.cye-enabled.cye-lm td{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>
html.cye-enabled.cye-lm input[type=text]{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}html.cye-enabled.cye-lm textarea{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>
html.cye-enabled.cye-lm select{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>
html.cye-enabled.cye-lm ul{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>
html.cye-enabled.cye-lm .cye-lm-tag,html.cye-enabled.cye-lm.cye-lm-tag{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}
</style>
<style>

</style>
<style>
object,embed{                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;                -o-animation-duration:.001s;-o-animation-name:playerInserted;                animation-duration:.001s;animation-name:playerInserted;}                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}
</style>
<style>
#rwl-iqxin{position:fixed;transform:translate(-90px,0);width:85px;height:25px;font-size:12px;font-weight: 500;font-family:Verdana, Arial, '宋体';color:#fff;background:#333;z-index:2147483647;margin: 0;opacity:0.05;transition:0.3s;overflow:hidden;user-select:none;text-align:center;white-space:nowrap;line-height:25px;padding:0 16px;border:1px solid #ccc;border-width:1px 1px 1px 0;border-bottom-right-radius:5px;box-sizing: content-box;}#rwl-iqxin input{margin: 0;padding: 0;vertical-align:middle;-webkit-appearance:checkbox;-moz-appearance:checkbox;position: static;clip: auto;opacity: 1;cursor: pointer;}#rwl-iqxin.rwl-active-iqxin{left: 0px;transform:translate(0,0);opacity: 0.9;height: 32px;line-height: 32px}#rwl-iqxin label{margin:0;padding:0;font-weight:500;}#rwl-iqxin button{margin: 0;padding: 0 2px;border: none;border-radius: 2px;cursor: pointer;}#rwl-setMenu{text-align:left;font-size:14px;z-index:999999;border: 1px solid cornflowerblue;}#rwl-setMenu p{margin:5px auto;} 
</style>
<style>
#leftdiv,#rightdiv,#stickey_footer,#top_box,.ershiba,.recommend-box,.floatBottom img,.ad_float_left,body .img,.side-widget,.blog-post  .row .side,.content__tech{display:none!important;}<br>.box.pic_text img,#wp img,#postlist img{max-height: 400px;width: auto;}<br>.post-topheader__info--title{text-align: center;}<br>.blog-post  .row .main,.container.main-container .container,.main-area.article-area{width: 100%;max-width: 100%;}<br><br>#juejin .container{max-width:1140px;}<br><br>.container.main-container .sidebar,.container.main-container .article-suspended-panel,.global-component-box .suspension-panel{display:none!important;}
</style>

    <style class="mx-wc-style">
      .mx-wc-main img {max-width: 100%;}
      .mx-wc-main{
        box-sizing: content-box;
        background-color: rgb(244, 245, 245) !important;
        margin: 0 auto;
        max-width: 1140px;
        padding: 15px 15px 80px 15px;
      }

      .clipping-information{
        text-align: left;
        margin-top: 20px;
        background-color: #eeeeee !important;
        padding: 15px;
        border-radius: 4px;
        color: #333;
        font-size: 14px !important;
        line-height: 22px !important;
      }
      .clipping-information a {
        color: blue !important;
        text-decoration: underline !important;
      }
      .clipping-information label {
        display: inline;
        text-transform: none;
      }
      .clipping-information label > code {
        padding: 2px 8px;
        background-color: rgba(200, 200, 200, 0.7)!important;
        font-size: 14px;
      }

    </style>
  </head>
  <body style="background-color: #464646 !important; min-height: 100%; height: auto;" id="" class="">
    <div class="mx-wc-main">
      <DIV id="juejin" data-v-514f306c="" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><DIV data-v-f6fdafdc="" data-v-f9ae5008="" data-v-514f306c="" class="view-container" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><MAIN data-v-f6fdafdc="" class="container main-container" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><DIV data-v-f9ae5008="" data-v-f6fdafdc="" class="view column-view" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><div data-v-f9ae5008="" data-v-f6fdafdc="" class="main-area article-area shadow mx-wc-selected-elem" style="float: none; position: relative; top: 0px; left: 0px; margin: 0px; flex: unset; width: 100%; max-width: 100%; box-sizing: border-box;"><article data-v-f9ae5008="" itemscope="itemscope" itemtype="http://schema.org/Article" class="article" data-v-f6fdafdc=""><div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"></div><div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"></div></div><div data-v-f9ae5008="" class="author-info-block"><a data-v-f9ae5008="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" class="avatar-link"><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-f9ae5008="" data-src="https://user-gold-cdn.xitu.io/2018/8/31/1658dd68f9ead6c0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2018/8/31/1658dd68f9ead6c0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a><div data-v-f9ae5008="" class="author-info-box"><a data-v-f9ae5008="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" class="username ellipsis">苏格团队</a><div data-v-f9ae5008="" class="meta-box"><time data-v-f9ae5008="" datetime="2019-03-25T00:57:59.424Z" title="Mon Mar 25 2019 08:57:59 GMT+0800 (中国标准时间)" class="time">2019年03月25日</time><span data-v-f9ae5008="" class="views-count">阅读 1097</span><!----></div></div><button data-v-3a6ba87a="" data-v-f9ae5008="" class="follow-button follow">关注</button></div><!----><h1 data-v-f9ae5008="" class="article-title">html5录音功能实战</h1><div data-v-f9ae5008="" data-id="5c982797e51d4540fb270f7a" itemprop="articleBody" class="article-content"><blockquote>
<ul>
<li>苏格团队</li>
<li>作者：Dee</li>
</ul>
</blockquote>
<h1 class="heading" data-id="heading-0">缘起</h1>
<p>由于项目需要，我们要在web端实现录音功能。一开始，找到的方案有两个，一个是通过iframe，一个是html5的getUserMedia api。由于我们的录音功能不需要兼容IE浏览器，所以毫不犹豫的选择了html5提供的getUserMedia去实现。基本思路是参考了官方的api文档以及网上查找的一些方案做结合做出了适合项目需要的方案。但由于我们必须保证这个录音功能能够同时在pad端、pc端都可以打开，所以其中也踩了一些坑。以下为过程还原。</p>
<h2 class="heading" data-id="heading-1">步骤1</h2>
<p>由于新的api是通过navigator.mediaDevices.getUserMedia，且返回一个promise。</p>
<p>而旧的api是navigator.getUserMedia，于是做了一个兼容性。代码如下：</p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-comment">// 老的浏览器可能根本没有实现 mediaDevices，所以我们可以先设置一个空的对象</span>
<span class="hljs-keyword">if</span> (navigator.mediaDevices === <span class="hljs-literal">undefined</span>) {
    navigator.mediaDevices = {};
}

<span class="hljs-comment">// 一些浏览器部分支持 mediaDevices。我们不能直接给对象设置 getUserMedia</span>
<span class="hljs-comment">// 因为这样可能会覆盖已有的属性。这里我们只会在没有getUserMedia属性的时候添加它。</span>
<span class="hljs-keyword">if</span> (navigator.mediaDevices.getUserMedia === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">let</span> getUserMedia =
        navigator.getUserMedia ||
        navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia ||
        navigator.msGetUserMedia;
    navigator.mediaDevices.getUserMedia = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">constraints</span>) </span>{
        <span class="hljs-comment">// 首先，如果有getUserMedia的话，就获得它</span>

        <span class="hljs-comment">// 一些浏览器根本没实现它 - 那么就返回一个error到promise的reject来保持一个统一的接口</span>
        <span class="hljs-keyword">if</span> (!getUserMedia) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'getUserMedia is not implemented in this browser'</span>));
        }

        <span class="hljs-comment">// 否则，为老的navigator.getUserMedia方法包裹一个Promise</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) </span>{
            getUserMedia.call(navigator, constraints, resolve, reject);
        });
    };
<span class="copy-code-btn">复制代码</span></code></pre><h2 class="heading" data-id="heading-2">步骤2</h2>
<p>这是网上存在的一个方法，封装了一个HZRecorder。基本上引用了这个方法。调用HZRecorder.get就可以调起录音接口，这个方法传入一个callback函数，new HZRecorder后执行callback函数且传入一个实体化后的HZRecorder对象。可以通过该对象的方法实现开始录音、暂停、停止、播放等功能。</p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-keyword">var</span> HZRecorder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">stream, config</span>) </span>{  
    config = config || {};  
    config.sampleBits = config.sampleBits || <span class="hljs-number">8</span>;      <span class="hljs-comment">//采样数位 8, 16  </span>
    config.sampleRate = config.sampleRate || (<span class="hljs-number">44100</span> / <span class="hljs-number">6</span>);   <span class="hljs-comment">//采样率(1/6 44100)  </span>

      
    <span class="hljs-comment">//创建一个音频环境对象  </span>
    audioContext = <span class="hljs-built_in">window</span>.AudioContext || <span class="hljs-built_in">window</span>.webkitAudioContext;  
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> audioContext();  

    <span class="hljs-comment">//将声音输入这个对像  </span>
    <span class="hljs-keyword">var</span> audioInput = context.createMediaStreamSource(stream);  
      
    <span class="hljs-comment">//设置音量节点  </span>
    <span class="hljs-keyword">var</span> volume = context.createGain();  
    audioInput.connect(volume);  

    <span class="hljs-comment">//创建缓存，用来缓存声音  </span>
    <span class="hljs-keyword">var</span> bufferSize = <span class="hljs-number">4096</span>;  

    <span class="hljs-comment">// 创建声音的缓存节点，createScriptProcessor方法的  </span>
    <span class="hljs-comment">// 第二个和第三个参数指的是输入和输出都是双声道。  </span>
    <span class="hljs-keyword">var</span> recorder = context.createScriptProcessor(bufferSize, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);  

    <span class="hljs-keyword">var</span> audioData = {  
        <span class="hljs-attr">size</span>: <span class="hljs-number">0</span>          <span class="hljs-comment">//录音文件长度  </span>
        , <span class="hljs-attr">buffer</span>: []     <span class="hljs-comment">//录音缓存  </span>
        , <span class="hljs-attr">inputSampleRate</span>: context.sampleRate    <span class="hljs-comment">//输入采样率  </span>
        , <span class="hljs-attr">inputSampleBits</span>: <span class="hljs-number">16</span>       <span class="hljs-comment">//输入采样数位 8, 16  </span>
        , <span class="hljs-attr">outputSampleRate</span>: config.sampleRate    <span class="hljs-comment">//输出采样率  </span>
        , <span class="hljs-attr">oututSampleBits</span>: config.sampleBits       <span class="hljs-comment">//输出采样数位 8, 16  </span>
        , <span class="hljs-attr">input</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{  
            <span class="hljs-keyword">this</span>.buffer.push(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(data));  
            <span class="hljs-keyword">this</span>.size += data.length;  
        }  
        , <span class="hljs-attr">compress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-comment">//合并压缩  </span>
            <span class="hljs-comment">//合并  </span>
            <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(<span class="hljs-keyword">this</span>.size);  
            <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;  
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.buffer.length; i++) {  
                data.set(<span class="hljs-keyword">this</span>.buffer[i], offset);  
                offset += <span class="hljs-keyword">this</span>.buffer[i].length;  
            }  
            <span class="hljs-comment">//压缩  </span>
            <span class="hljs-keyword">var</span> compression = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.inputSampleRate / <span class="hljs-keyword">this</span>.outputSampleRate);  
            <span class="hljs-keyword">var</span> length = data.length / compression;  
            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(length);  
            <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;  
            <span class="hljs-keyword">while</span> (index &lt; length) {  
                result[index] = data[j];  
                j += compression;  
                index++;  
            }  
            <span class="hljs-keyword">return</span> result;  
        }  
        , <span class="hljs-attr">encodeWAV</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{  
            <span class="hljs-keyword">var</span> sampleRate = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.inputSampleRate, <span class="hljs-keyword">this</span>.outputSampleRate);  
            <span class="hljs-keyword">var</span> sampleBits = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.inputSampleBits, <span class="hljs-keyword">this</span>.oututSampleBits);  
            <span class="hljs-keyword">var</span> bytes = <span class="hljs-keyword">this</span>.compress();  
            <span class="hljs-keyword">var</span> dataLength = bytes.length * (sampleBits / <span class="hljs-number">8</span>);  
            <span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">44</span> + dataLength);  
            <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(buffer);  

            <span class="hljs-keyword">var</span> channelCount = <span class="hljs-number">1</span>;<span class="hljs-comment">//单声道  </span>
            <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;  

            <span class="hljs-keyword">var</span> writeString = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>{  
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; str.length; i++) {  
                    data.setUint8(offset + i, str.charCodeAt(i));  
                }  
            };  
              
            <span class="hljs-comment">// 资源交换文件标识符   </span>
            writeString(<span class="hljs-string">'RIFF'</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 下个地址开始到文件尾总字节数,即文件大小-8   </span>
            data.setUint32(offset, <span class="hljs-number">36</span> + dataLength, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// WAV文件标志  </span>
            writeString(<span class="hljs-string">'WAVE'</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 波形格式标志   </span>
            writeString(<span class="hljs-string">'fmt '</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 过滤字节,一般为 0x10 = 16   </span>
            data.setUint32(offset, <span class="hljs-number">16</span>, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 格式类别 (PCM形式采样数据)   </span>
            data.setUint16(offset, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">2</span>;  
            <span class="hljs-comment">// 通道数   </span>
            data.setUint16(offset, channelCount, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">2</span>;  
            <span class="hljs-comment">// 采样率,每秒样本数,表示每个通道的播放速度   </span>
            data.setUint32(offset, sampleRate, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 波形数据传输率 (每秒平均字节数) 单声道×每秒数据位数×每样本数据位/8   </span>
            data.setUint32(offset, channelCount * sampleRate * (sampleBits / <span class="hljs-number">8</span>), <span class="hljs-literal">true</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 快数据调整数 采样一次占用字节数 单声道×每样本的数据位数/8   </span>
            data.setUint16(offset, channelCount * (sampleBits / <span class="hljs-number">8</span>), <span class="hljs-literal">true</span>); offset += <span class="hljs-number">2</span>;  
            <span class="hljs-comment">// 每样本数据位数   </span>
            data.setUint16(offset, sampleBits, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">2</span>;  
            <span class="hljs-comment">// 数据标识符   </span>
            writeString(<span class="hljs-string">'data'</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 采样数据总数,即数据总大小-44   </span>
            data.setUint32(offset, dataLength, <span class="hljs-literal">true</span>); offset += <span class="hljs-number">4</span>;  
            <span class="hljs-comment">// 写入采样数据   </span>
            <span class="hljs-keyword">if</span> (sampleBits === <span class="hljs-number">8</span>) {  
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; bytes.length; i++, offset++) {  
                    <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">-1</span>, <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, bytes[i]));  
                    <span class="hljs-keyword">var</span> val = s &lt; <span class="hljs-number">0</span> ? s * <span class="hljs-number">0x8000</span> : s * <span class="hljs-number">0x7FFF</span>;  
                    val = <span class="hljs-built_in">parseInt</span>(<span class="hljs-number">255</span> / (<span class="hljs-number">65535</span> / (val + <span class="hljs-number">32768</span>)));  
                    data.setInt8(offset, val, <span class="hljs-literal">true</span>);  
                }  
            } <span class="hljs-keyword">else</span> {  
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; bytes.length; i++, offset += <span class="hljs-number">2</span>) {  
                    <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">-1</span>, <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, bytes[i]));  
                    data.setInt16(offset, s &lt; <span class="hljs-number">0</span> ? s * <span class="hljs-number">0x8000</span> : s * <span class="hljs-number">0x7FFF</span>, <span class="hljs-literal">true</span>);  
                }  
            }  

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Blob([data], { <span class="hljs-attr">type</span>: <span class="hljs-string">'audio/wav'</span> });  
        }  
    };  

    <span class="hljs-comment">//开始录音  </span>
    <span class="hljs-keyword">this</span>.start = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{  
        audioInput.connect(recorder);  
        recorder.connect(context.destination);  
    };  

    <span class="hljs-comment">//停止  </span>
    <span class="hljs-keyword">this</span>.stop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{  
        recorder.disconnect();  
    };  
    
    <span class="hljs-comment">// 结束</span>
    <span class="hljs-keyword">this</span>.end = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        context.close();
    };
    
    <span class="hljs-comment">// 继续</span>
    <span class="hljs-keyword">this</span>.again = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        recorder.connect(context.destination);
    };

    <span class="hljs-comment">//获取音频文件  </span>
    <span class="hljs-keyword">this</span>.getBlob = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{  
        <span class="hljs-keyword">this</span>.stop();  
        <span class="hljs-keyword">return</span> audioData.encodeWAV();  
    };  

    <span class="hljs-comment">//回放  </span>
    <span class="hljs-keyword">this</span>.play = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">audio</span>) </span>{  
        audio.src = <span class="hljs-built_in">window</span>.URL.createObjectURL(<span class="hljs-keyword">this</span>.getBlob());  
    };  

    <span class="hljs-comment">//上传  </span>
    <span class="hljs-keyword">this</span>.upload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">url, callback</span>) </span>{  
        <span class="hljs-keyword">var</span> fd = <span class="hljs-keyword">new</span> FormData();  
        fd.append(<span class="hljs-string">'audioData'</span>, <span class="hljs-keyword">this</span>.getBlob());  
        <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();  
        <span class="hljs-keyword">if</span> (callback) {  
            xhr.upload.addEventListener(<span class="hljs-string">'progress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  
                callback(<span class="hljs-string">'uploading'</span>, e);  
            }, <span class="hljs-literal">false</span>);  
            xhr.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  
                callback(<span class="hljs-string">'ok'</span>, e);  
            }, <span class="hljs-literal">false</span>);  
            xhr.addEventListener(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  
                callback(<span class="hljs-string">'error'</span>, e);  
            }, <span class="hljs-literal">false</span>);  
            xhr.addEventListener(<span class="hljs-string">'abort'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  
                callback(<span class="hljs-string">'cancel'</span>, e);  
            }, <span class="hljs-literal">false</span>);  
        }  
        xhr.open(<span class="hljs-string">'POST'</span>, url);  
        xhr.send(fd);  
    };  

    <span class="hljs-comment">//音频采集  </span>
    recorder.onaudioprocess = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  
        audioData.input(e.inputBuffer.getChannelData(<span class="hljs-number">0</span>));  
        <span class="hljs-comment">//record(e.inputBuffer.getChannelData(0));  </span>
    };  

};  

<span class="hljs-comment">//抛出异常  </span>
HZRecorder.throwError = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">message</span>) </span>{  
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">this</span>.toString = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> message; };};  
};  
<span class="hljs-comment">//是否支持录音  </span>
HZRecorder.canRecording = (navigator.getUserMedia != <span class="hljs-literal">null</span>);  
<span class="hljs-comment">//获取录音机  </span>
HZRecorder.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback, config</span>) </span>{  
   <span class="hljs-keyword">if</span> (callback) {
        navigator.mediaDevices
            .getUserMedia({ <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span> })
            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">stream</span>) </span>{
                <span class="hljs-keyword">let</span> rec = <span class="hljs-keyword">new</span> HZRecorder(stream, config);
                callback(rec);
            })
            .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                HZRecorder.throwError(<span class="hljs-string">'无法录音，请检查设备状态'</span>);
            });
    }
};  
<span class="hljs-built_in">window</span>.HZRecorder = HZRecorder;
<span class="copy-code-btn">复制代码</span></code></pre><p>以上，已经可以满足大部分的需求。但是我们要兼容pad端。我们的pad有几个问题必须解决。</p>
<ul>
<li>录音格式必须是mp3才能播放</li>
<li>window.URL.createObjectURL传入blob数据在pad端报错，转不了</li>
</ul>
<p>以下为解决这两个问题的方案。</p>
<h2 class="heading" data-id="heading-3">步骤3</h2>
<p>以下为我实现 <strong>录音格式为mp3</strong> 和 <strong>window.URL.createObjectURL传入blob数据在pad端报错</strong> 的方案。</p>
<p>1、修改HZRecorder里的audioData对象代码。并引入网上一位大神的一个js文件lamejs.js</p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-keyword">const</span> lame = <span class="hljs-keyword">new</span> lamejs();
<span class="hljs-keyword">let</span> audioData = {
    <span class="hljs-attr">samplesMono</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">maxSamples</span>: <span class="hljs-number">1152</span>,
    <span class="hljs-attr">mp3Encoder</span>: <span class="hljs-keyword">new</span> lame.Mp3Encoder(<span class="hljs-number">1</span>, context.sampleRate || <span class="hljs-number">44100</span>, config.bitRate || <span class="hljs-number">128</span>),
    <span class="hljs-attr">dataBuffer</span>: [],
    <span class="hljs-attr">size</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 录音文件长度</span>
    buffer: [], <span class="hljs-comment">// 录音缓存</span>
    inputSampleRate: context.sampleRate, <span class="hljs-comment">// 输入采样率</span>
    inputSampleBits: <span class="hljs-number">16</span>, <span class="hljs-comment">// 输入采样数位 8, 16</span>
    outputSampleRate: config.sampleRate, <span class="hljs-comment">// 输出采样率</span>
    oututSampleBits: config.sampleBits, <span class="hljs-comment">// 输出采样数位 8, 16</span>
    convertBuffer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arrayBuffer</span>) </span>{
        <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(arrayBuffer);
        <span class="hljs-keyword">let</span> out = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Int16Array</span>(arrayBuffer.length);
        <span class="hljs-keyword">this</span>.floatTo16BitPCM(data, out);
        <span class="hljs-keyword">return</span> out;
    },
    <span class="hljs-attr">floatTo16BitPCM</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input, output</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; input.length; i++) {
            <span class="hljs-keyword">let</span> s = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">-1</span>, <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, input[i]));
            output[i] = s &lt; <span class="hljs-number">0</span> ? s * <span class="hljs-number">0x8000</span> : s * <span class="hljs-number">0x7fff</span>;
        }
    },
    <span class="hljs-attr">appendToBuffer</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mp3Buf</span>) </span>{
        <span class="hljs-keyword">this</span>.dataBuffer.push(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Int8Array</span>(mp3Buf));
    },
    <span class="hljs-attr">encode</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arrayBuffer</span>) </span>{
        <span class="hljs-keyword">this</span>.samplesMono = <span class="hljs-keyword">this</span>.convertBuffer(arrayBuffer);
        <span class="hljs-keyword">let</span> remaining = <span class="hljs-keyword">this</span>.samplesMono.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; remaining &gt;= <span class="hljs-number">0</span>; i += <span class="hljs-keyword">this</span>.maxSamples) {
            <span class="hljs-keyword">let</span> left = <span class="hljs-keyword">this</span>.samplesMono.subarray(i, i + <span class="hljs-keyword">this</span>.maxSamples);
            <span class="hljs-keyword">let</span> mp3buf = <span class="hljs-keyword">this</span>.mp3Encoder.encodeBuffer(left);
            <span class="hljs-keyword">this</span>.appendToBuffer(mp3buf);
            remaining -= <span class="hljs-keyword">this</span>.maxSamples;
        }
    },
    <span class="hljs-attr">finish</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.appendToBuffer(<span class="hljs-keyword">this</span>.mp3Encoder.flush());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Blob(<span class="hljs-keyword">this</span>.dataBuffer, { <span class="hljs-attr">type</span>: <span class="hljs-string">'audio/mp3'</span> });
    },
    <span class="hljs-attr">input</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">this</span>.buffer.push(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(data));
        <span class="hljs-keyword">this</span>.size += data.length;
    },
    <span class="hljs-attr">compress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// 合并压缩</span>
        <span class="hljs-comment">// 合并</span>
        <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(<span class="hljs-keyword">this</span>.size);
        <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.buffer.length; i++) {
            data.set(<span class="hljs-keyword">this</span>.buffer[i], offset);
            offset += <span class="hljs-keyword">this</span>.buffer[i].length;
        }
        <span class="hljs-comment">// 压缩</span>
        <span class="hljs-keyword">let</span> compression = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.inputSampleRate / <span class="hljs-keyword">this</span>.outputSampleRate, <span class="hljs-number">10</span>);
        <span class="hljs-keyword">let</span> length = data.length / compression;
        <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(length);
        <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (index &lt; length) {
            result[index] = data[j];
            j += compression;
            index++;
        }
        <span class="hljs-keyword">return</span> result;
    },
    <span class="hljs-attr">encodeWAV</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">let</span> sampleRate = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.inputSampleRate, <span class="hljs-keyword">this</span>.outputSampleRate);
        <span class="hljs-keyword">let</span> sampleBits = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.inputSampleBits, <span class="hljs-keyword">this</span>.oututSampleBits);
        <span class="hljs-keyword">let</span> bytes = <span class="hljs-keyword">this</span>.compress();
        <span class="hljs-keyword">let</span> dataLength = bytes.length * (sampleBits / <span class="hljs-number">8</span>);
        <span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">44</span> + dataLength);
        <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(buffer);

        <span class="hljs-keyword">let</span> channelCount = <span class="hljs-number">1</span>; <span class="hljs-comment">// 单声道</span>
        <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">let</span> writeString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; str.length; i++) {
                data.setUint8(offset + i, str.charCodeAt(i));
            }
        };

        <span class="hljs-comment">// 资源交换文件标识符</span>
        writeString(<span class="hljs-string">'RIFF'</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 下个地址开始到文件尾总字节数,即文件大小-8</span>
        data.setUint32(offset, <span class="hljs-number">36</span> + dataLength, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// WAV文件标志</span>
        writeString(<span class="hljs-string">'WAVE'</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 波形格式标志</span>
        writeString(<span class="hljs-string">'fmt '</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 过滤字节,一般为 0x10 = 16</span>
        data.setUint32(offset, <span class="hljs-number">16</span>, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 格式类别 (PCM形式采样数据)</span>
        data.setUint16(offset, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">2</span>;
        <span class="hljs-comment">// 通道数</span>
        data.setUint16(offset, channelCount, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">2</span>;
        <span class="hljs-comment">// 采样率,每秒样本数,表示每个通道的播放速度</span>
        data.setUint32(offset, sampleRate, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 波形数据传输率 (每秒平均字节数) 单声道×每秒数据位数×每样本数据位/8</span>
        data.setUint32(offset, channelCount * sampleRate * (sampleBits / <span class="hljs-number">8</span>), <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 快数据调整数 采样一次占用字节数 单声道×每样本的数据位数/8</span>
        data.setUint16(offset, channelCount * (sampleBits / <span class="hljs-number">8</span>), <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">2</span>;
        <span class="hljs-comment">// 每样本数据位数</span>
        data.setUint16(offset, sampleBits, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">2</span>;
        <span class="hljs-comment">// 数据标识符</span>
        writeString(<span class="hljs-string">'data'</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 采样数据总数,即数据总大小-44</span>
        data.setUint32(offset, dataLength, <span class="hljs-literal">true</span>);
        offset += <span class="hljs-number">4</span>;
        <span class="hljs-comment">// 写入采样数据</span>
        <span class="hljs-keyword">if</span> (sampleBits === <span class="hljs-number">8</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bytes.length; i++, offset++) {
                <span class="hljs-keyword">const</span> s = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">-1</span>, <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, bytes[i]));
                <span class="hljs-keyword">let</span> val = s &lt; <span class="hljs-number">0</span> ? s * <span class="hljs-number">0x8000</span> : s * <span class="hljs-number">0x7fff</span>;
                val = <span class="hljs-built_in">parseInt</span>(<span class="hljs-number">255</span> / (<span class="hljs-number">65535</span> / (val + <span class="hljs-number">32768</span>)), <span class="hljs-number">10</span>);
                data.setInt8(offset, val, <span class="hljs-literal">true</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bytes.length; i++, offset += <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">const</span> s = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">-1</span>, <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, bytes[i]));
                data.setInt16(offset, s &lt; <span class="hljs-number">0</span> ? s * <span class="hljs-number">0x8000</span> : s * <span class="hljs-number">0x7fff</span>, <span class="hljs-literal">true</span>);
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Blob([data], { <span class="hljs-attr">type</span>: <span class="hljs-string">'audio/wav'</span> });
    }
};

<span class="copy-code-btn">复制代码</span></code></pre><p>2、修改HZRecord的音频采集的调用方法。</p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-comment">// 音频采集</span>
recorder.onaudioprocess = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    audioData.encode(e.inputBuffer.getChannelData(<span class="hljs-number">0</span>));
};
<span class="copy-code-btn">复制代码</span></code></pre><p>3、HZRecord的getBlob方法。</p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-keyword">this</span>.getBlob = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.stop();
    <span class="hljs-keyword">return</span> audioData.finish();
};
<span class="copy-code-btn">复制代码</span></code></pre><p>4、HZRecord的play方法。把blob转base64url。</p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-keyword">this</span>.play = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">func</span>) </span>{
    readBlobAsDataURL(<span class="hljs-keyword">this</span>.getBlob(), func);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readBlobAsDataURL</span>(<span class="hljs-params">data, callback</span>) </span>{
    <span class="hljs-keyword">let</span> fileReader = <span class="hljs-keyword">new</span> FileReader();
    fileReader.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        callback(e.target.result);
    };
    fileReader.readAsDataURL(data);
}
<span class="copy-code-btn">复制代码</span></code></pre><p>至此，已经解决以上两个问题。</p>
<h2 class="heading" data-id="heading-4">步骤4</h2>
<p>这里主要介绍怎么做录音时的动效。我们的一个动效需求为：</p>
<p>根据传入的音量大小，做一个圆弧动态扩展。</p>
<p></p><figure><img class="lazyload inited loaded" data-src="assets/1553502781-921c4faa96d6a41b2f84ff683955ac14" data-width="496" data-height="246" src="assets/1553502781-921c4faa96d6a41b2f84ff683955ac14"><figcaption></figcaption></figure><p></p>
<pre><code class="hljs js copyable" lang="js"><span class="hljs-comment">// 创建analyser节点，获取音频时间和频率数据</span>
<span class="hljs-keyword">const</span> analyser = context.createAnalyser();
audioInput.connect(analyser);
<span class="hljs-keyword">const</span> inputAnalyser = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> wrapEle = $<span class="hljs-keyword">this</span>.refs[<span class="hljs-string">'wrap'</span>];
<span class="hljs-keyword">let</span> ctx = wrapEle.getContext(<span class="hljs-string">'2d'</span>);
<span class="hljs-keyword">const</span> width = wrapEle.width;
<span class="hljs-keyword">const</span> height = wrapEle.height;
<span class="hljs-keyword">const</span> center = {
    <span class="hljs-attr">x</span>: width / <span class="hljs-number">2</span>,
    <span class="hljs-attr">y</span>: height / <span class="hljs-number">2</span>
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawArc</span>(<span class="hljs-params">ctx, color, x, y, radius, beginAngle, endAngle</span>) </span>{
    ctx.beginPath();
    ctx.lineWidth = <span class="hljs-number">1</span>;
    ctx.strokeStyle = color;
    ctx.arc(x, y, radius, (<span class="hljs-built_in">Math</span>.PI * beginAngle) / <span class="hljs-number">180</span>, (<span class="hljs-built_in">Math</span>.PI * endAngle) / <span class="hljs-number">180</span>);
    ctx.stroke();
}

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawSpectrum</span>(<span class="hljs-params"></span>) </span>{
    analyser.getByteFrequencyData(inputAnalyser); <span class="hljs-comment">// 获取频域数据</span>
    ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);
    <span class="hljs-comment">// 画线条</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>; i++) {
        <span class="hljs-keyword">let</span> value = inputAnalyser[i] / <span class="hljs-number">3</span>; <span class="hljs-comment">// &lt;===获取数据</span>
        <span class="hljs-keyword">let</span> colors = [];
        <span class="hljs-keyword">if</span> (value &lt;= <span class="hljs-number">16</span>) {
            colors = [<span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#e4e4e4'</span>, <span class="hljs-string">'#e4e4e4'</span>, <span class="hljs-string">'#e4e4e4'</span>, <span class="hljs-string">'#e4e4e4'</span>];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt;= <span class="hljs-number">32</span>) {
            colors = [<span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#e4e4e4'</span>, <span class="hljs-string">'#e4e4e4'</span>];
        } <span class="hljs-keyword">else</span> {
            colors = [<span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>, <span class="hljs-string">'#f5A631'</span>];
        }
        drawArc(ctx, colors[<span class="hljs-number">0</span>], center.x, center.y, <span class="hljs-number">52</span> + <span class="hljs-number">16</span>, <span class="hljs-number">-30</span>, <span class="hljs-number">30</span>);
        drawArc(ctx, colors[<span class="hljs-number">1</span>], center.x, center.y, <span class="hljs-number">52</span> + <span class="hljs-number">16</span>, <span class="hljs-number">150</span>, <span class="hljs-number">210</span>);
        drawArc(ctx, colors[<span class="hljs-number">2</span>], center.x, center.y, <span class="hljs-number">52</span> + <span class="hljs-number">32</span>, <span class="hljs-number">-22.5</span>, <span class="hljs-number">22.5</span>);
        drawArc(ctx, colors[<span class="hljs-number">3</span>], center.x, center.y, <span class="hljs-number">52</span> + <span class="hljs-number">32</span>, <span class="hljs-number">157.5</span>, <span class="hljs-number">202.5</span>);
        drawArc(ctx, colors[<span class="hljs-number">4</span>], center.x, center.y, <span class="hljs-number">52</span> + <span class="hljs-number">48</span>, <span class="hljs-number">-13</span>, <span class="hljs-number">13</span>);
        drawArc(ctx, colors[<span class="hljs-number">5</span>], center.x, center.y, <span class="hljs-number">52</span> + <span class="hljs-number">48</span>, <span class="hljs-number">167</span>, <span class="hljs-number">193</span>);
    }

    <span class="hljs-comment">// 请求下一帧</span>
    requestAnimationFrame(drawSpectrum);
})();
<span class="copy-code-btn">复制代码</span></code></pre><h1 class="heading" data-id="heading-5">缘尽</h1>
<p>至此，一个完整的html5录音功能方案已经完成。有什么需要补充，不合理的地方的欢迎留言。</p>
<p>ps：lamejs可参考这个github
<a target="_blank" href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fakrennmair%2Flibmp3lame-js" rel="nofollow noopener noreferrer">github.com/akrennmair/…</a></p>
</div></article><div data-v-f9ae5008="" data-v-f6fdafdc="" class="tag-list-box"><div data-v-f9ae5008="" data-v-f6fdafdc="" class="tag-list-title">关注下面的标签，发现更多相似文章</div><div data-v-f9ae5008="" data-v-f6fdafdc="" st:block="tagList" class="tag-list"><a data-v-f9ae5008="" href="https://juejin.im/tag/HTML" target="_blank" rel="" st:name="tag" class="item" data-v-f6fdafdc=""><div data-v-5b957c59="" data-v-5f4c8686="" data-v-f9ae5008="" data-src="https://lc-gold-cdn.xitu.io/f18965b2a0ef9cac862e.png?imageView2/2/w/42/h/42/q/85/format/webp/interlace/1" class="lazy thumb tag-icon loaded" style="background-image: url(&quot;https://lc-gold-cdn.xitu.io/f18965b2a0ef9cac862e.png?imageView2/2/w/42/h/42/q/85/format/webp/interlace/1&quot;); background-size: contain;"></div><div data-v-f9ae5008="" class="tag-title">HTML</div></a></div></div><a data-v-f9ae5008="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" data-v-f6fdafdc=""><div data-v-f9ae5008="" class="footer-author-block"><div data-v-ccbf6674="" data-v-f9ae5008="" itemscope="itemscope" itemtype="http://schema.org/Person" class="author"><div itemprop="memberOf" itemscope="itemscope" itemtype="http://schema.org/Organization"></div><div data-v-ccbf6674="" class="author-info-block"><a data-v-ccbf6674="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" class="avatar-link"><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-ccbf6674="" data-src="https://user-gold-cdn.xitu.io/2018/8/31/1658dd68f9ead6c0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2018/8/31/1658dd68f9ead6c0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a><div data-v-ccbf6674="" class="author-info-box"><div data-v-ccbf6674="" class="profile-box"><a data-v-ccbf6674="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" class="username ellipsis">苏格团队</a><span data-v-ccbf6674="" class="position ellipsis">技术 @ 苏格</span></div><div data-v-ccbf6674="" class="meta-box"><a data-v-ccbf6674="" href="https://juejin.im/user/5b88a73ce51d453884363524/posts" target="_blank" rel="" class="posts"><span data-v-ccbf6674="" class="count post-count">发布了 28 篇专栏 · </span></a><span data-v-ccbf6674="" class="count">获得点赞 2,052 次 · </span><span data-v-ccbf6674="" class="count">文章被阅读 46,820 次</span></div></div><button data-v-3a6ba87a="" data-v-ccbf6674="" class="follow-button follow">关注</button></div></div></div></a><div data-v-f9ae5008="" data-v-f6fdafdc="" st:block="banner" class="article-banner"><a data-v-f9ae5008="" data-v-f6fdafdc="" st:name="link" st:state="https://juejin.im/extension/?utm_source=juejin.im&amp;utm_medium=post&amp;utm_campaign=extension_promotion" class="banner-title" href="https://juejin.im/extension/?utm_source=juejin.im&amp;utm_medium=post&amp;utm_campaign=extension_promotion" target="_blank">安装掘金浏览器插件</a><div data-v-f9ae5008="" data-v-f6fdafdc="" class="banner-content">打开新标签页发现好内容，掘金、GitHub、Dribbble、ProductHunt 等站点内容轻松获取。快来安装掘金浏览器插件获取高质量内容吧！</div></div><!----><!----><div data-v-6bc5fe54="" data-v-f9ae5008="" class="comment-list-box" id="comment-box" data-v-f6fdafdc=""><div data-v-6bc5fe54="" class="title">评论</div><div data-v-0f4f171a="" data-v-6bc5fe54="" class="comment-form comment-form"><div data-v-0f4f171a="" class="avatar-box"><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-0f4f171a="" data-src="https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg&quot;);"></div></div><div data-v-0f4f171a="" class="form-box"><div data-v-0f4f171a="" class="input-box"><div data-v-0f4f171a="" contenteditable="true" spellcheck="false" placeholder="输入评论..." class="rich-input empty"><br data-v-0f4f171a=""></div><!----></div><!----></div></div><div data-v-2cad70f5="" data-v-6bc5fe54="" class="comment-list comment-list"><div data-v-3d504eeb="" data-v-2cad70f5="" class="image-viewer-box"><!----></div><div data-v-2cad70f5="" class="item"><div data-v-419974fe="" data-v-2cad70f5="" class="comment comment"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="589574be61ff4b006b0631e5" class="user-popover-box popover"><!----><a data-v-419974fe="" href="https://juejin.im/user/589574be61ff4b006b0631e5" target="_blank" rel="" class="user-link" data-v-14a78378=""><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-419974fe="" data-src="https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg&quot;);"></div></a></div><div data-v-419974fe="" class="content-box comment-divider-line"><div data-v-419974fe="" class="meta-box"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="589574be61ff4b006b0631e5" class="user-popover-box"><!----><a data-v-419974fe="" href="https://juejin.im/user/589574be61ff4b006b0631e5" target="_blank" rel="" class="username ellipsis" data-v-14a78378="">白驹<!----></a></div><div data-v-419974fe="" class="position"></div></div><div data-v-419974fe="" class="content">大佬，有遇到最后生成的MP3播放的时候的声音感觉和原声不一样的情况吗</div><div data-v-419974fe="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-419974fe="" class="reply-stat"><time data-v-419974fe="" datetime="2019-03-25T03:10:34.575Z" title="Mon Mar 25 2019 11:10:34 GMT+0800 (中国标准时间)" class="time">5小时前</time><div data-v-419974fe="" class="action-box"><div data-v-419974fe="" class="like-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-419974fe="" class="comment-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-419974fe="" class="action-title">回复</span></div></div></div><!----><div data-v-2140efbc="" data-v-419974fe="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div><div data-v-2cad70f5="" class="item"><div data-v-419974fe="" data-v-2cad70f5="" class="comment comment"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="5a435a58f265da431c7095ed" class="user-popover-box popover"><!----><a data-v-419974fe="" href="https://juejin.im/user/5a435a58f265da431c7095ed" target="_blank" rel="" class="user-link" data-v-14a78378=""><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-419974fe="" data-src="https://user-gold-cdn.xitu.io/2017/12/28/1609a98d8cba3863?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2017/12/28/1609a98d8cba3863?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-419974fe="" class="content-box comment-divider-line"><div data-v-419974fe="" class="meta-box"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="5a435a58f265da431c7095ed" class="user-popover-box"><!----><a data-v-419974fe="" href="https://juejin.im/user/5a435a58f265da431c7095ed" target="_blank" rel="" class="username ellipsis" data-v-14a78378="">HKHenry<!----></a></div><div data-v-419974fe="" class="position">前端大中华区技术总监 @ HK科技</div></div><div data-v-419974fe="" class="content">高手</div><div data-v-419974fe="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-419974fe="" class="reply-stat"><time data-v-419974fe="" datetime="2019-03-25T02:51:11.888Z" title="Mon Mar 25 2019 10:51:11 GMT+0800 (中国标准时间)" class="time">5小时前</time><div data-v-419974fe="" class="action-box"><div data-v-419974fe="" class="like-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-419974fe="" class="comment-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-419974fe="" class="action-title">回复</span></div></div></div><!----><div data-v-2140efbc="" data-v-419974fe="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div><div data-v-2cad70f5="" class="item"><div data-v-419974fe="" data-v-2cad70f5="" class="comment comment"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="5accd1d35188255cb07d739d" class="user-popover-box popover"><!----><a data-v-419974fe="" href="https://juejin.im/user/5accd1d35188255cb07d739d" target="_blank" rel="" class="user-link" data-v-14a78378=""><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-419974fe="" data-src="https://mirror-gold-cdn.xitu.io/168e08ed7b5cc562203?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e08ed7b5cc562203?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-419974fe="" class="content-box comment-divider-line"><div data-v-419974fe="" class="meta-box"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="5accd1d35188255cb07d739d" class="user-popover-box"><!----><a data-v-419974fe="" href="https://juejin.im/user/5accd1d35188255cb07d739d" target="_blank" rel="" class="username ellipsis" data-v-14a78378="">willylee007<!----></a></div><div data-v-419974fe="" class="position"></div></div><div data-v-419974fe="" class="content">您好, 想问一下, getUserMedia这个接口能同时录电脑播放的音乐以及麦克风的声音吗</div><div data-v-419974fe="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-419974fe="" class="reply-stat"><time data-v-419974fe="" datetime="2019-03-25T01:55:24.151Z" title="Mon Mar 25 2019 09:55:24 GMT+0800 (中国标准时间)" class="time">6小时前</time><div data-v-419974fe="" class="action-box"><div data-v-419974fe="" class="like-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-419974fe="" class="comment-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-419974fe="" class="action-title">回复</span></div></div></div><!----><div data-v-2140efbc="" data-v-419974fe="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div><div data-v-2cad70f5="" class="item"><div data-v-419974fe="" data-v-2cad70f5="" class="comment comment"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="57b501897db2a20054702769" class="user-popover-box popover"><!----><a data-v-419974fe="" href="https://juejin.im/user/57b501897db2a20054702769" target="_blank" rel="" class="user-link" data-v-14a78378=""><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-419974fe="" data-src="https://user-gold-cdn.xitu.io/2019/1/22/1687615087679020?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2019/1/22/1687615087679020?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-419974fe="" class="content-box comment-divider-line"><div data-v-419974fe="" class="meta-box"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="57b501897db2a20054702769" class="user-popover-box"><!----><a data-v-419974fe="" href="https://juejin.im/user/57b501897db2a20054702769" target="_blank" rel="" class="username ellipsis" data-v-14a78378="">冯冯墨墨<!----></a></div><div data-v-419974fe="" class="position">默默耕耘的搬砖者</div></div><div data-v-419974fe="" class="content">h5录音功能 在iPhone设备上不会出现问题吗</div><div data-v-419974fe="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-419974fe="" class="reply-stat"><time data-v-419974fe="" datetime="2019-03-25T01:30:23.621Z" title="Mon Mar 25 2019 09:30:23 GMT+0800 (中国标准时间)" class="time">6小时前</time><div data-v-419974fe="" class="action-box"><div data-v-419974fe="" class="like-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-419974fe="" class="comment-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-419974fe="" class="action-title">回复</span></div></div></div><!----><div data-v-2140efbc="" data-v-419974fe="" class="sub-comment-list sub-comment-list"><div data-v-2140efbc="" class="item"><div data-v-63734c60="" data-v-2140efbc="" class="sub-comment sub-comment"><div data-v-63734c60="" class="sub-comment-content-row"><div data-v-63734c60="" class="sub-comment-content-box"><div data-v-14a78378="" data-v-63734c60="" st:block="userPopover" st:state="5b88a73ce51d453884363524" class="user-popover-box popover"><!----><a data-v-63734c60="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" class="username" data-v-14a78378=""><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-63734c60="" data-src="https://user-gold-cdn.xitu.io/2018/8/31/1658dd68f9ead6c0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2018/8/31/1658dd68f9ead6c0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-63734c60="" class="user-content-box"><div data-v-63734c60="" class="profie"><div data-v-14a78378="" data-v-63734c60="" st:block="userPopover" st:state="5b88a73ce51d453884363524" class="user-popover-box"><!----><a data-v-63734c60="" href="https://juejin.im/user/5b88a73ce51d453884363524" target="_blank" rel="" class="username" data-v-14a78378="">苏格团队<span data-v-63734c60="" class="author-badge-text">(作者)</span></a></div><div data-v-63734c60="" class="position">技术 @ 苏格</div></div><div data-v-63734c60="" class="content-box"><span data-v-63734c60=""> 回复 </span><div data-v-14a78378="" data-v-63734c60="" st:block="userPopover" st:state="57b501897db2a20054702769" class="user-popover-box"><!----><a data-v-63734c60="" href="https://juejin.im/user/57b501897db2a20054702769" target="_blank" rel="" class="username be-replied" data-v-14a78378="">冯冯墨墨</a></div><!----><span data-v-63734c60="">: </span><span data-v-63734c60="" class="content">你遇到了啥问题？</span></div><!----><!----><div data-v-63734c60="" class="limit-all-box"><!----></div><div data-v-63734c60="" class="sub-comment-stat-box"><time data-v-63734c60="" datetime="2019-03-25T02:45:23.863Z" title="Mon Mar 25 2019 10:45:23 GMT+0800 (中国标准时间)" class="time">5小时前</time><div data-v-63734c60="" class="sub-comment-action-box"><div data-v-63734c60="" class="like-action action"><svg data-v-63734c60="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-63734c60="" fill="none" fill-rule="evenodd"><path data-v-63734c60="" d="M0 0h20v20H0z"></path> <path data-v-63734c60="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-63734c60="" class="comment-action action"><svg data-v-63734c60="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-63734c60="" fill="none" fill-rule="evenodd"><path data-v-63734c60="" d="M0 0h20v20H0z"></path> <path data-v-63734c60="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-63734c60="">回复</span></div></div></div><!----></div></div></div><!----></div></div><!----></div></div><!----></div></div><div data-v-2cad70f5="" class="item"><div data-v-419974fe="" data-v-2cad70f5="" class="comment comment"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="57b5438dc4c971005f9007a9" class="user-popover-box popover"><!----><a data-v-419974fe="" href="https://juejin.im/user/57b5438dc4c971005f9007a9" target="_blank" rel="" class="user-link" data-v-14a78378=""><div data-v-5b957c59="" data-v-b5e0fa26="" data-v-419974fe="" data-src="https://mirror-gold-cdn.xitu.io/168e082f957c5a29da9?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e082f957c5a29da9?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-419974fe="" class="content-box comment-divider-line"><div data-v-419974fe="" class="meta-box"><div data-v-14a78378="" data-v-419974fe="" st:block="userPopover" st:state="57b5438dc4c971005f9007a9" class="user-popover-box"><!----><a data-v-419974fe="" href="https://juejin.im/user/57b5438dc4c971005f9007a9" target="_blank" rel="" class="username ellipsis" data-v-14a78378="">Tomato_CN<!----></a></div><div data-v-419974fe="" class="position">前端开发</div></div><div data-v-419974fe="" class="content">学习</div><div data-v-419974fe="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-419974fe="" class="reply-stat"><time data-v-419974fe="" datetime="2019-03-25T01:01:46.538Z" title="Mon Mar 25 2019 09:01:46 GMT+0800 (中国标准时间)" class="time">7小时前</time><div data-v-419974fe="" class="action-box"><div data-v-419974fe="" class="like-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-419974fe="" class="comment-action action"><svg data-v-419974fe="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-419974fe="" fill="none" fill-rule="evenodd"><path data-v-419974fe="" d="M0 0h20v20H0z"></path> <path data-v-419974fe="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-419974fe="" class="action-title">回复</span></div></div></div><!----><div data-v-2140efbc="" data-v-419974fe="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div></div><!----></div></div></DIV></MAIN></DIV></DIV>
      
        <hr />
        <!-- clipping information -->
        <div class="clipping-information">
          <label>原网址: <a href="https://juejin.im/post/5c9826ac5188256d5328b9f6" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">访问</a></label><br />
          <label>创建于: 2019-03-25 16:33:01</label><br />
          <label>目录: default</label><br />
          <label>标签: 无</label>
        </div>
    </div>
  </body>
</html>