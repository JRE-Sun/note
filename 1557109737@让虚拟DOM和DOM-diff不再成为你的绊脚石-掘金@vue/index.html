
<!DOCTYPE html>
<html>
  <!-- OriginalSrc: https://juejin.im/post/5c8e5e4951882545c109ae9c -->
  <head>
    <meta http-equiv="Content-Type" content="text/html"; charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>è®©è™šæ‹ŸDOMå’ŒDOM-diffä¸å†æˆä¸ºä½ çš„ç»Šè„šçŸ³ - æ˜é‡‘@vue</title>
    
<link rel="stylesheet" href="assets/1557109737-1f9e0f727e6a99422a0a1f6e2139bd56.css">

<link rel="stylesheet" href="assets/1557109737-39cb236590c2d7f28116c42fb1c4858a.css">

<link href="assets/1557109737-883defa5388981e6f49116c12e7b8a2a.css" rel="stylesheet">
<style>
body {
        font-size: 16px;
        line-height: 2;
      }
      a, button, input {
        margin: 1rem 1.5rem;
      }
      img {
        width: 0;
        height: 0;
      }
      #juejin {
        overflow-x: hidden;
      }
</style>
<style>

</style>
<style>

:root .sidebar-bd-entry,
:root .topbanner,
:root .container > a.mid-wrapper,
:root .content > a > .topline
{ display: none !important; }
</style>
<style>
object,embed{                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;                -o-animation-duration:.001s;-o-animation-name:playerInserted;                animation-duration:.001s;animation-name:playerInserted;}                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}
</style>
<style>
#rwl-iqxin{position:fixed;transform:translate(-90px,0);width:85px;height:25px;font-size:12px;font-weight: 500;font-family:Verdana, Arial, 'å®‹ä½“';color:#fff;background:#333;z-index:2147483647;margin: 0;opacity:0.05;transition:0.3s;overflow:hidden;user-select:none;text-align:center;white-space:nowrap;line-height:25px;padding:0 16px;border:1px solid #ccc;border-width:1px 1px 1px 0;border-bottom-right-radius:5px;box-sizing: content-box;}#rwl-iqxin input{margin: 0;padding: 0;vertical-align:middle;-webkit-appearance:checkbox;-moz-appearance:checkbox;position: static;clip: auto;opacity: 1;cursor: pointer;}#rwl-iqxin.rwl-active-iqxin{left: 0px;transform:translate(0,0);opacity: 0.9;height: 32px;line-height: 32px}#rwl-iqxin label{margin:0;padding:0;font-weight:500;}#rwl-iqxin button{margin: 0;padding: 0 2px;border: none;border-radius: 2px;cursor: pointer;}#rwl-setMenu{text-align:left;font-size:14px;z-index:999999;border: 1px solid cornflowerblue;}#rwl-setMenu p{margin:5px auto;} 
</style>
<style>
#leftdiv,#rightdiv,#stickey_footer,#top_box,.ershiba,.recommend-box,.floatBottom img,.ad_float_left,body .img,.side-widget,.blog-post  .row .side,.content__tech,.bui-left.index-left{display:none!important;}<br>.box.pic_text img,#wp img,#postlist img{max-height: 400px;width: auto;}<br>.post-topheader__info--title{text-align: center;}<br>.blog-post  .row .main,.container.main-container .container,.main-area.article-area{width: 100%;max-width: 100%;}<br><br>#juejin .container{max-width:1140px;}<br><br>.container.main-container .sidebar,.container.main-container .article-suspended-panel,.global-component-box .suspension-panel{display:none!important;}<br>
</style>

    <style class="mx-wc-style">
      .mx-wc-main img {max-width: 100%;}
      .mx-wc-main{
        background-color: rgb(244, 245, 245) !important;
        margin: 0 auto;
        min-width: 100%!important;
        max-width: 100%!important;
        width: 100%!important;
        padding: 15px!important;
        box-sizing: border-box;
      }
      .mx-wc-main .single .content{border:none!important;}
      .mx-wc-main .show-content .image-package{margin-left:0!important;}
      code{white-space:pre-wrap!important;}

      .clipping-information{
        text-align: left;
        margin-top: 20px;
        background-color: #eeeeee !important;
        padding: 15px;
        border-radius: 4px;
        color: #333;
        font-size: 14px !important;
        line-height: 22px !important;
      }
      .clipping-information a {
        color: blue !important;
        text-decoration: underline !important;
      }
      .clipping-information label {
        display: inline;
        text-transform: none;
      }
      .clipping-information label > code {
        padding: 2px 8px;
        background-color: rgba(200, 200, 200, 0.7)!important;
        font-size: 14px;
      }

    </style>
  </head>
  <body style="background-color: #464646 !important;min-height:100%;min-width:100%!important;max-width:100%!important;width:100%!important; height: auto;" id="" class="">
    <div class="mx-wc-main">
      <DIV id="juejin" data-v-514f306c="" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><DIV data-v-4b868639="" data-v-4a12c3f3="" data-v-514f306c="" class="view-container" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><MAIN data-v-4b868639="" class="container main-container" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><DIV data-v-4a12c3f3="" data-v-4b868639="" class="view column-view" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><div data-v-4a12c3f3="" data-v-4b868639="" class="main-area article-area shadow mx-wc-selected-elem" style="float: none; position: relative; top: 0px; left: 0px; margin: 0px; flex: unset; width: 100%; max-width: 100%; box-sizing: border-box;"><article data-v-4a12c3f3="" itemscope="itemscope" itemtype="http://schema.org/Article" class="article" data-v-4b868639=""><div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"></div><div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"></div></div><div data-v-4a12c3f3="" class="author-info-block"><a data-v-4a12c3f3="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="avatar-link"><div data-v-acf63380="" data-v-37d9a154="" data-v-4a12c3f3="" data-src="https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a><div data-v-4a12c3f3="" class="author-info-box"><a data-v-4a12c3f3="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="username ellipsis">chenhongdong</a><div data-v-4a12c3f3="" class="meta-box"><time data-v-4a12c3f3="" datetime="2019-03-25T02:03:30.945Z" title="Mon Mar 25 2019 10:03:30 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">2019å¹´03æœˆ25æ—¥</time><span data-v-4a12c3f3="" class="views-count">é˜…è¯» 11171</span><!----></div></div><button data-v-2fe230ac="" data-v-4a12c3f3="" class="follow-button follow">å…³æ³¨</button></div><div data-v-acf63380="" data-v-21eddaa6="" data-v-4a12c3f3="" data-src="https://user-gold-cdn.xitu.io/2019/3/25/169b296058910187?imageView2/1/w/1304/h/734/q/85/format/webp/interlace/1" class="lazy thumb article-hero loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2019/3/25/169b296058910187?imageView2/1/w/1304/h/734/q/85/format/webp/interlace/1&quot;); background-size: cover;"></div><h1 data-v-4a12c3f3="" class="article-title">è®©è™šæ‹ŸDOMå’ŒDOM-diffä¸å†æˆä¸ºä½ çš„ç»Šè„šçŸ³</h1><div data-v-4a12c3f3="" data-id="5c9836f26fb9a070ac66aebb" itemprop="articleBody" class="article-content"><h2 class="heading" data-id="heading-0">Keep Moving</h2>
<p>æ—¶è‡³ä»Šæ—¥ï¼Œå‰ç«¯å¯¹äºçŸ¥è¯†çš„è€ƒé‡æ˜¯è¶Šæ¥è¶Šæœ‰æ°´å¹³äº†ï¼Œé€¼æ ¼é«˜å¤§ä¸Šäº†</p>
<p>å„ç±»æ¡†æ¶å¤§å®¶å·²ç»å¯ä»¥è¯´æ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯æ—¥å¸¸ä¸­éƒ½å·²ç»æˆ–å¤šæˆ–å°‘çš„ä½¿ç”¨è¿‡äº†</p>
<p>æ›¾ç»å¬è¯´å¾ˆå¤šäººè¢«é—®åˆ°è¿‡è™šæ‹ŸDOMå’ŒDOM-diffç®—æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæœ‰æ²¡æœ‰ç ”ç©¶è¿‡ï¼Ÿ</p>
<p>æƒ³å¿…é—®å‡ºæ­¤é—®é¢˜çš„ä¹Ÿæ˜¯é«˜æ‰‹é«˜æ‰‹ä¹‹é«˜é«˜æ‰‹äº†ï¼Œå¾ˆå¤šäººéƒ½åŠå¼€ç©ç¬‘çš„è¯´ï¼šâ€œé¢è¯•é€ èˆªæ¯ï¼Œå·¥ä½œæ‹§èºä¸â€</p>
<p>é‚£ä¹ˆï¼Œè¯ä¸å¤šè¯´äº†ï¼Œä»Šå¤©å°±è®©æˆ‘ä»¬ä¹Ÿæ¥ä¸€èµ·ç ”ç©¶ç ”ç©¶è¿™ä¸ªä¸œä¸œ</p>
<p>å¥½é¥­ä¸æ€•æ™šï¼Œæ²‰æ·€ä¸‹æ¥æ”¶æ”¶å¿ƒï¼æˆ‘ä»¬è™½ç„¶èµ°çš„æ…¢ï¼Œä½†æ˜¯å´ä»æœªåœä¸‹è„šæ­¥</p>
<h2 class="heading" data-id="heading-1">ç¥å¥‡çš„è™šæ‹ŸDOM</h2>
<p>é¦–å…ˆç¥å¥‡ä¸ç¥å¥‡çš„æˆ‘ä»¬å…ˆä¸å»å…³æ³¨ï¼Œå…ˆæ¥ç®€å•è¯´è¯´ä½•ä¸ºè™šæ‹ŸDOM</p>
<p><strong>è™šæ‹ŸDOM</strong>ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼Œç”¨JSå»æŒ‰ç…§DOMç»“æ„æ¥å®ç°çš„æ ‘å½¢ç»“æ„å¯¹è±¡ï¼Œä½ ä¹Ÿå¯ä»¥å«åš<strong>DOMå¯¹è±¡</strong></p>
<p>å¥½äº†ï¼Œä¸€å¥è¯å°±æŠŠè¿™ä¹ˆä¼Ÿå¤§çš„ä¸œè¥¿ç»™è§£é‡Šäº†ï¼Œé‚£ä¹ˆä¸å†è€½è¯¯æ—¶é—´äº†ï¼Œèµ¶ç´§è¿›å…¥ä¸»ç¯èŠ‚å§</p>
<p>å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰æ•´ä¸ªé¡¹ç›®çš„<a target="_blank" href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fchenhongdong%2Farticle%2Ftree%2Fdevelop%2F%25E8%2599%259A%25E6%258B%259Fdom%2Fdom-diff" rel="nofollow noopener noreferrer">åœ°å€</a>æ–¹ä¾¿æŸ¥çœ‹</p>
<h3 class="heading" data-id="heading-2">å®ç°ä¸€ä¸‹è™šæ‹ŸDOM</h3>
<p>åœ¨äº²è‡ªä¸Šé˜µä¹‹å‰ï¼Œæˆ‘ä»¬è®©ç²®è‰å…ˆè¡Œï¼Œå…ˆå‘ä¸ªå›¾ï¼Œæ¥çœ‹ä¸€ä¸‹æ•´ä¸ªç›®å½•ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­çš„
</p><figure><img class="lazyload inited loaded" data-src="assets/1557109737-095a923e41c910461e35af1507e189cd" data-width="324" data-height="331" src="assets/1557109737-095a923e41c910461e35af1507e189cd"><figcaption></figcaption></figure>
è¿™ä¸ªç›®å½•ç»“æ„æ˜¯ç”¨<strong>create-react-appè„šæ‰‹æ¶</strong>ç›´æ¥ç”Ÿæˆçš„ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿ç¼–è¯‘è°ƒè¯•<p></p>
<pre><code class="hljs bash copyable" lang="bash">// å…¨å±€å®‰è£…
npm i create-react-app -g
// ç”Ÿæˆé¡¹ç›®
create-react-app dom-diff
// è¿›å…¥é¡¹ç›®ç›®å½•
<span class="hljs-built_in">cd</span> dom-diff
// ç¼–è¯‘
npm run start
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>ç°åœ¨æˆ‘ä»¬å¼€å§‹æ­£å¼å†™å§ï¼Œä»åˆ›å»ºè™šæ‹ŸDOMåŠæ¸²æŸ“DOMèµ·æ­¥å§</p>
<h4 class="heading" data-id="heading-3">åˆ›å»ºè™šæ‹ŸDOM</h4>
<p>åœ¨element.jsæ–‡ä»¶ä¸­è¦å®ç°å¦‚ä½•åˆ›å»ºè™šæ‹ŸDOMä»¥åŠå°†åˆ›å»ºå‡ºæ¥çš„è™šæ‹ŸDOMæ¸²æŸ“æˆçœŸå®çš„DOM</p>
<p>é¦–å…ˆå®ç°ä¸€ä¸‹å¦‚ä½•åˆ›å»ºè™šæ‹ŸDOMï¼Œçœ‹ä»£ç ï¼š</p>
<pre><code class="hljs bash copyable" lang="bash">// element.js

// è™šæ‹ŸDOMå…ƒç´ çš„ç±»ï¼Œæ„å»ºå®ä¾‹å¯¹è±¡ï¼Œç”¨æ¥æè¿°DOM
class Element {
    constructor(<span class="hljs-built_in">type</span>, props, children) {
        this.type = <span class="hljs-built_in">type</span>;
        this.props = props;
        this.children = children;
    }
}
// åˆ›å»ºè™šæ‹ŸDOMï¼Œè¿”å›è™šæ‹ŸèŠ‚ç‚¹(object)
<span class="hljs-keyword">function</span> createElement(<span class="hljs-built_in">type</span>, props, children) {
    <span class="hljs-built_in">return</span> new Element(<span class="hljs-built_in">type</span>, props, children);
}

<span class="hljs-built_in">export</span> {
    Element,
    createElement
}
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>å†™å¥½äº†æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä»index.jsæ–‡ä»¶å…¥æ‰‹æ¥çœ‹çœ‹æ˜¯å¦æˆåŠŸå§</p>
<h4 class="heading" data-id="heading-4">è°ƒç”¨createElementæ–¹æ³•</h4>
<p>åœ¨ä¸»å…¥å£æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬ä¸»è¦åšçš„æ“ä½œå°±æ˜¯æ¥åˆ›å»ºä¸€ä¸ªDOMå¯¹è±¡ï¼Œæ¸²æŸ“DOMä»¥åŠé€šè¿‡diffåå»æ‰“è¡¥ä¸æ›´æ–°DOMï¼Œä¸å•°å—¦äº†ï¼Œç›´æ¥çœ‹ä»£ç ï¼š</p>
<pre><code class="hljs bash copyable" lang="bash">// index.js

// é¦–å…ˆå¼•å…¥å¯¹åº”çš„æ–¹æ³•æ¥åˆ›å»ºè™šæ‹ŸDOM
import { createElement } from <span class="hljs-string">'./element'</span>;

<span class="hljs-built_in">let</span> virtualDom = createElement(<span class="hljs-string">'ul'</span>, {class: <span class="hljs-string">'list'</span>}, [
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'å‘¨æ°ä¼¦'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'æ—ä¿Šæ°'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'ç‹åŠ›å®'</span>])
]);

console.log(virtualDom);
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>createElementæ–¹æ³•ä¹Ÿæ˜¯vueå’Œreactç”¨æ¥åˆ›å»ºè™šæ‹ŸDOMçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå«è¿™ä¸ªåå­—ï¼Œæ–¹ä¾¿è®°å¿†ã€‚æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<strong>type</strong>ï¼Œ<strong>props</strong>å’Œ<strong>children</strong></p>
<ul>
<li>å‚æ•°åˆ†æ
<ul>
<li>type: æŒ‡å®šå…ƒç´ çš„æ ‡ç­¾ç±»å‹ï¼Œå¦‚'li', 'div', 'a'ç­‰</li>
<li>props: è¡¨ç¤ºæŒ‡å®šå…ƒç´ èº«ä¸Šçš„å±æ€§ï¼Œå¦‚class, style, è‡ªå®šä¹‰å±æ€§ç­‰</li>
<li>children: è¡¨ç¤ºæŒ‡å®šå…ƒç´ æ˜¯å¦æœ‰å­èŠ‚ç‚¹ï¼Œå‚æ•°ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥</li>
</ul>
</li>
</ul>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹æ‰“å°å‡ºæ¥çš„è™šæ‹ŸDOMï¼Œå¦‚ä¸‹å›¾
</p><figure><img class="lazyload inited loaded" data-src="assets/1557109737-f21bf0e9402bed5fa5c20ac3b5bd7d30" data-width="665" data-height="352" src="assets/1557109737-f21bf0e9402bed5fa5c20ac3b5bd7d30"><figcaption></figcaption></figure>
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»è½»è€Œæ˜“ä¸¾çš„å®ç°äº†åˆ›å»ºè™šæ‹ŸDOMã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œå°†å…¶æ¸²æŸ“ä¸ºçœŸå®çš„DOMï¼Œåˆ«çŠ¹è±«ï¼Œç»§ç»­å›åˆ°element.jsæ–‡ä»¶ä¸­<p></p>
<h4 class="heading" data-id="heading-5">æ¸²æŸ“è™šæ‹ŸDOM</h4>
<pre><code class="hljs bash copyable" lang="bash">// element.js

class Element {
    // çœç•¥
}

<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">createElement</span></span>() {
    // çœç•¥
}

// renderæ–¹æ³•å¯ä»¥å°†è™šæ‹ŸDOMè½¬åŒ–æˆçœŸå®DOM
<span class="hljs-keyword">function</span> render(domObj) {
    // æ ¹æ®<span class="hljs-built_in">type</span>ç±»å‹æ¥åˆ›å»ºå¯¹åº”çš„å…ƒç´ 
    <span class="hljs-built_in">let</span> el = document.createElement(domObj.type);
    
    // å†å»éå†propså±æ€§å¯¹è±¡ï¼Œç„¶åç»™åˆ›å»ºçš„å…ƒç´ elè®¾ç½®å±æ€§
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> key <span class="hljs-keyword">in</span> domObj.props) {
        // è®¾ç½®å±æ€§çš„æ–¹æ³•
        <span class="hljs-built_in">set</span>Attr(el, key, domObj.props[key]);
    }
    
    // éå†å­èŠ‚ç‚¹
    // å¦‚æœæ˜¯è™šæ‹ŸDOMï¼Œå°±ç»§ç»­é€’å½’æ¸²æŸ“
    // ä¸æ˜¯å°±ä»£è¡¨æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œç›´æ¥åˆ›å»º
    domObj.children.forEach(child =&gt; {
        child = (child instanceof Element) ? render(child) : document.createTextNode(child);
        // æ·»åŠ åˆ°å¯¹åº”å…ƒç´ å†…
        el.appendChild(child);
    });

    <span class="hljs-built_in">return</span> el;
}

// è®¾ç½®å±æ€§
<span class="hljs-keyword">function</span> <span class="hljs-built_in">set</span>Attr(node, key, value) {
    switch(key) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'value'</span>:
            // nodeæ˜¯ä¸€ä¸ªinputæˆ–è€…textareaå°±ç›´æ¥è®¾ç½®å…¶valueå³å¯
            <span class="hljs-keyword">if</span> (node.tagName.toLowerCase() === <span class="hljs-string">'input'</span> ||
                node.tagName.toLowerCase() === <span class="hljs-string">'textarea'</span>) {
                node.value = value;
            } <span class="hljs-keyword">else</span> {
                node.setAttribute(key, value);
            }
            <span class="hljs-built_in">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'style'</span>:
            // ç›´æ¥èµ‹å€¼è¡Œå†…æ ·å¼
            node.style.cssText = value;
            <span class="hljs-built_in">break</span>;
        default:
            node.setAttribute(key, value);
            <span class="hljs-built_in">break</span>;
    }
}

// å°†å…ƒç´ æ’å…¥åˆ°é¡µé¢å†…
<span class="hljs-keyword">function</span> renderDom(el, target) {
    target.appendChild(el);
}

<span class="hljs-built_in">export</span> {
    Element,
    createElement,
    render,
    <span class="hljs-built_in">set</span>Attr,
    renderDom
};
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>æ—¢ç„¶å†™å®Œäº†ï¼Œé‚£å°±èµ¶å¿«æ¥çœ‹çœ‹æˆæœå§</p>
<h4 class="heading" data-id="heading-6">è°ƒç”¨renderæ–¹æ³•</h4>
<p>å†æ¬¡å›åˆ°index.jsæ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç </p>
<pre><code class="hljs bash copyable" lang="bash">// index.js

// å¼•å…¥createElementã€renderå’ŒrenderDomæ–¹æ³•
import { createElement, render, renderDom } from <span class="hljs-string">'./element'</span>;

<span class="hljs-built_in">let</span> virtualDom = createElement(<span class="hljs-string">'ul'</span>, {class: <span class="hljs-string">'list'</span>}, [
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'å‘¨æ°ä¼¦'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'æ—ä¿Šæ°'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'ç‹åŠ›å®'</span>])
]);

console.log(virtualDom);

// +++
<span class="hljs-built_in">let</span> el = render(virtualDom); // æ¸²æŸ“è™šæ‹ŸDOMå¾—åˆ°çœŸå®çš„DOMç»“æ„
console.log(el);
// ç›´æ¥å°†DOMæ·»åŠ åˆ°é¡µé¢å†…
renderDom(el, document.getElementById(<span class="hljs-string">'root'</span>));
// +++
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>é€šè¿‡è°ƒç”¨renderæ–¹æ³•è½¬ä¸ºçœŸå®DOMï¼Œå¹¶è°ƒç”¨renderDomæ–¹æ³•ç›´æ¥å°†DOMæ·»åŠ åˆ°äº†é¡µé¢å†…</p>
<p>ä¸‹å›¾ä¸ºæ‰“å°åçš„ç»“æœï¼š
</p><figure><img class="lazyload inited loaded" data-src="assets/1557109737-b963ca44048a25bb1129659f25c8aa5c" data-width="658" data-height="154" src="assets/1557109737-b963ca44048a25bb1129659f25c8aa5c"><figcaption></figcaption></figure>
æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†è™šæ‹ŸDOMå¹¶è¿›è¡Œäº†æ¸²æŸ“çœŸå®DOMåˆ°é¡µé¢ä¸­ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æœ‰è¯·DOM-difféš†é‡ç™»åœºï¼Œæ¥çœ‹ä¸€ä¸‹è¿™å¤§æœ‰æ¥å¤´çš„diffç®—æ³•æ˜¯å¦‚ä½•å‘å…‰å‘çƒ­çš„å§ï¼<p></p>
<h2 class="heading" data-id="heading-7">DOM-diffé—ªäº®ç™»åœº</h2>
<p>è¯´åˆ°DOM-diffé‚£ä¸€å®šè¦æ¸…æ¥šå…¶å­˜åœ¨çš„æ„ä¹‰ï¼Œç»™å®šä»»æ„ä¸¤æ£µæ ‘ï¼Œé‡‡ç”¨<strong>å…ˆåºæ·±åº¦ä¼˜å…ˆéå†</strong>çš„ç®—æ³•æ‰¾åˆ°æœ€å°‘çš„è½¬æ¢æ­¥éª¤</p>
<p>DOM-diffæ¯”è¾ƒä¸¤ä¸ªè™šæ‹ŸDOMçš„åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åŒºåˆ«ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong> æ ¹æ®ä¸¤ä¸ªè™šæ‹Ÿå¯¹è±¡åˆ›å»ºå‡ºè¡¥ä¸ï¼Œæè¿°æ”¹å˜çš„å†…å®¹ï¼Œå°†è¿™ä¸ªè¡¥ä¸ç”¨æ¥æ›´æ–°DOM</p>
<p>å·²ç»äº†è§£åˆ°DOM-diffæ˜¯å¹²å˜›çš„äº†ï¼Œé‚£å°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œç»§ç»­å¾€ä¸‹å†™å§</p>
<pre><code class="hljs bash copyable" lang="bash">// diff.js

<span class="hljs-keyword">function</span> diff(oldTree, newTree) {
    // å£°æ˜å˜é‡patchesç”¨æ¥å­˜æ”¾è¡¥ä¸çš„å¯¹è±¡
    <span class="hljs-built_in">let</span> patches = {};
    // ç¬¬ä¸€æ¬¡æ¯”è¾ƒåº”è¯¥æ˜¯æ ‘çš„ç¬¬0ä¸ªç´¢å¼•
    <span class="hljs-built_in">let</span> index = 0;
    // é€’å½’æ ‘ æ¯”è¾ƒåçš„ç»“æœæ”¾åˆ°è¡¥ä¸é‡Œ
    walk(oldTree, newTree, index, patches);

    <span class="hljs-built_in">return</span> patches;
}

<span class="hljs-keyword">function</span> walk(oldNode, newNode, index, patches) {
    // æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªè¡¥ä¸
    <span class="hljs-built_in">let</span> current = [];

    <span class="hljs-keyword">if</span> (!newNode) { // rule1
        current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'REMOVE'</span>, index });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isString(oldNode) &amp;&amp; isString(newNode)) {
        // åˆ¤æ–­æ–‡æœ¬æ˜¯å¦ä¸€è‡´
        <span class="hljs-keyword">if</span> (oldNode !== newNode) {
            current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'TEXT'</span>, text: newNode });
        }

    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldNode.type === newNode.type) {
        // æ¯”è¾ƒå±æ€§æ˜¯å¦æœ‰æ›´æ”¹
        <span class="hljs-built_in">let</span> attr = diffAttr(oldNode.props, newNode.props);
        <span class="hljs-keyword">if</span> (Object.keys(attr).length &gt; 0) {
            current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'ATTR'</span>, attr });
        }
        // å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œéå†å­èŠ‚ç‚¹
        diffChildren(oldNode.children, newNode.children, patches);
    } <span class="hljs-keyword">else</span> {    // è¯´æ˜èŠ‚ç‚¹è¢«æ›¿æ¢äº†
        current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'REPLACE'</span>, newNode});
    }
    
    // å½“å‰å…ƒç´ ç¡®å®æœ‰è¡¥ä¸å­˜åœ¨
    <span class="hljs-keyword">if</span> (current.length) {
        // å°†å…ƒç´ å’Œè¡¥ä¸å¯¹åº”èµ·æ¥ï¼Œæ”¾åˆ°å¤§è¡¥ä¸åŒ…ä¸­
        patches[index] = current;
    }
}

<span class="hljs-keyword">function</span> isString(obj) {
    <span class="hljs-built_in">return</span> typeof obj === <span class="hljs-string">'string'</span>;
}

<span class="hljs-keyword">function</span> diffAttr(oldAttrs, newAttrs) {
    <span class="hljs-built_in">let</span> patch = {};
    // åˆ¤æ–­è€çš„å±æ€§ä¸­å’Œæ–°çš„å±æ€§çš„å…³ç³»
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> key <span class="hljs-keyword">in</span> oldAttrs) {
        <span class="hljs-keyword">if</span> (oldAttrs[key] !== newAttrs[key]) {
            patch[key] = newAttrs[key]; // æœ‰å¯èƒ½è¿˜æ˜¯undefined
        }
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> key <span class="hljs-keyword">in</span> newAttrs) {
        // è€èŠ‚ç‚¹æ²¡æœ‰æ–°èŠ‚ç‚¹çš„å±æ€§
        <span class="hljs-keyword">if</span> (!oldAttrs.hasOwnProperty(key)) {
            patch[key] = newAttrs[key];
        }
    }
    <span class="hljs-built_in">return</span> patch;
}

// æ‰€æœ‰éƒ½åŸºäºä¸€ä¸ªåºå·æ¥å®ç°
<span class="hljs-built_in">let</span> num = 0;

<span class="hljs-keyword">function</span> diffChildren(oldChildren, newChildren, patches) {
    // æ¯”è¾ƒè€çš„ç¬¬ä¸€ä¸ªå’Œæ–°çš„ç¬¬ä¸€ä¸ª
    oldChildren.forEach((child, index) =&gt; {
        walk(child, newChildren[index], ++num, patches);
    });
}

// é»˜è®¤å¯¼å‡º
<span class="hljs-built_in">export</span> default diff;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>ä»£ç è™½ç„¶åˆè‡­åˆé•¿ï¼Œä½†æ˜¯è¿™äº›ä»£ç å°±è®©æˆ‘ä»¬å®ç°äº†diffç®—æ³•äº†ï¼Œæ‰€ä»¥å¤§å®¶å…ˆä¸è¦ç›²åŠ¨ï¼Œä¸è¦ç›²åŠ¨ï¼Œä¸”å¬é£åŸï¼Œè®©æˆ‘ä¸€ä¸€é“æ¥</p>
<h3 class="heading" data-id="heading-8">æ¯”è¾ƒè§„åˆ™</h3>
<ul>
<li>æ–°çš„DOMèŠ‚ç‚¹ä¸å­˜åœ¨{type: 'REMOVE', index}</li>
<li>æ–‡æœ¬çš„å˜åŒ–{type: 'TEXT', text: 1}</li>
<li>å½“èŠ‚ç‚¹ç±»å‹ç›¸åŒæ—¶ï¼Œå»çœ‹ä¸€ä¸‹å±æ€§æ˜¯å¦ç›¸åŒï¼Œäº§ç”Ÿä¸€ä¸ªå±æ€§çš„è¡¥ä¸åŒ…{type: 'ATTR', attr: {class: 'list-group'}}</li>
<li>èŠ‚ç‚¹ç±»å‹ä¸ç›¸åŒï¼Œç›´æ¥é‡‡ç”¨æ›¿æ¢æ¨¡å¼{type: 'REPLACE', newNode}</li>
</ul>
<p>æ ¹æ®è¿™äº›<strong>è§„åˆ™</strong>ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹diffä»£ç ä¸­çš„<strong>walkæ–¹æ³•</strong>è¿™ä½å…³é”®å…ˆç”Ÿ</p>
<p>walkæ–¹æ³•éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªè¡¥ä¸ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªæ”¾å½“å‰è¡¥ä¸çš„æ•°ç»„</li>
<li>å¦‚æœæ²¡æœ‰newèŠ‚ç‚¹çš„è¯ï¼Œå°±ç›´æ¥å°†typeä¸ºREMOVEçš„ç±»å‹æ”¾åˆ°å½“å‰è¡¥ä¸é‡Œ</li>
</ul>
<pre><code class="hljs bash copyable" lang="bash">    <span class="hljs-keyword">if</span> (!newNode) {
        current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'REMOVE'</span>, index });
    }
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><ul>
<li>å¦‚æœæ–°è€èŠ‚ç‚¹æ˜¯æ–‡æœ¬çš„è¯ï¼Œåˆ¤æ–­ä¸€ä¸‹æ–‡æœ¬æ˜¯å¦ä¸€è‡´ï¼Œå†æŒ‡å®šç±»å‹TEXTå¹¶æŠŠæ–°èŠ‚ç‚¹æ”¾åˆ°å½“å‰è¡¥ä¸</li>
</ul>
<pre><code class="hljs bash copyable" lang="bash">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isString(oldNode) &amp;&amp; isString(newNode)) {
        <span class="hljs-keyword">if</span> (oldNode !== newNode) {
            current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'TEXT'</span>, text: newNode });
        }
    }
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><ul>
<li>å¦‚æœæ–°è€èŠ‚ç‚¹çš„ç±»å‹ç›¸åŒï¼Œé‚£ä¹ˆå°±æ¥æ¯”è¾ƒä¸€ä¸‹ä»–ä»¬çš„å±æ€§props
<ul>
<li>å±æ€§æ¯”è¾ƒ
<ul>
<li>diffAttr
<ul>
<li>å»æ¯”è¾ƒæ–°è€Attræ˜¯å¦ç›¸åŒ</li>
<li>æŠŠnewAttrçš„é”®å€¼å¯¹èµ‹ç»™patchå¯¹è±¡ä¸Šå¹¶è¿”å›æ­¤å¯¹è±¡</li>
</ul>
</li>
</ul>
</li>
<li>ç„¶åå¦‚æœæœ‰å­èŠ‚ç‚¹çš„è¯å°±å†æ¯”è¾ƒä¸€ä¸‹å­èŠ‚ç‚¹çš„ä¸åŒï¼Œå†è°ƒä¸€æ¬¡walk
<ul>
<li>diffChildren
<ul>
<li>éå†oldChildrenï¼Œç„¶åé€’å½’è°ƒç”¨walkå†é€šè¿‡childå’ŒnewChildren[index]å»diff</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs bash copyable" lang="bash">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldNode.type === newNode.type) {
        // æ¯”è¾ƒå±æ€§æ˜¯å¦æœ‰æ›´æ”¹
        <span class="hljs-built_in">let</span> attr = diffAttr(oldNode.props, newNode.props);
        <span class="hljs-keyword">if</span> (Object.keys(attr).length &gt; 0) {
            current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'ATTR'</span>, attr });
        }
        
        // å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œéå†å­èŠ‚ç‚¹
        diffChildren(oldNode.children, newNode.children, patches);
    }
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><ul>
<li>ä¸Šé¢ä¸‰ä¸ªå¦‚æœéƒ½æ²¡æœ‰å‘ç”Ÿçš„è¯ï¼Œé‚£å°±è¡¨ç¤ºèŠ‚ç‚¹å•çº¯çš„è¢«æ›¿æ¢äº†ï¼Œtypeä¸ºREPLACEï¼Œç›´æ¥ç”¨newNodeæ›¿æ¢å³å¯</li>
</ul>
<pre><code class="hljs bash copyable" lang="bash">    <span class="hljs-keyword">else</span> {
        current.push({ <span class="hljs-built_in">type</span>: <span class="hljs-string">'REPLACE'</span>, newNode});
    }
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><ul>
<li>å½“å‰è¡¥ä¸é‡Œç¡®å®æœ‰å€¼çš„æƒ…å†µï¼Œå°±å°†å¯¹åº”çš„è¡¥ä¸æ”¾è¿›å¤§è¡¥ä¸åŒ…é‡Œ</li>
</ul>
<pre><code class="hljs bash copyable" lang="bash">    <span class="hljs-keyword">if</span> (current.length &gt; 0) {
        // å°†å…ƒç´ å’Œè¡¥ä¸å¯¹åº”èµ·æ¥ï¼Œæ”¾åˆ°å¤§è¡¥ä¸åŒ…ä¸­
        patches[index] = current;
    }
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>ä»¥ä¸Šå°±æ˜¯å…³äºdiffç®—æ³•çš„åˆ†æè¿‡ç¨‹äº†ï¼Œæ²¡å¤ªæ˜ç™½çš„è¯æ²¡å…³ç³»ï¼Œå†åå¤çœ‹å‡ éè¯•è¯•ï¼Œæ„å¤–æ€»æ˜¯ä¸æœŸè€Œé‡çš„</p>
<p>diffå·²ç»å®Œäº‹äº†ï¼Œé‚£ä¹ˆæœ€åä¸€æ­¥å°±æ˜¯å¤§å®¶æ‰€ç†ŸçŸ¥çš„<strong>æ‰“è¡¥ä¸</strong>äº†</p>
<p>è¡¥ä¸è¦æ€ä¹ˆæ‰“ï¼Ÿé‚£ä¹ˆè®©ä¹…è¿çš„patchå‡ºæ¥å§</p>
<h2 class="heading" data-id="heading-9">patchè¡¥ä¸æ›´æ–°</h2>
<p>æ‰“è¡¥ä¸éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¦æ‰“è¡¥ä¸çš„å…ƒç´ ï¼Œå¦ä¸€ä¸ªå°±æ˜¯æ‰€è¦æ‰“çš„è¡¥ä¸äº†ï¼Œé‚£ä¹ˆç›´æ¥çœ‹ä»£ç </p>
<pre><code class="hljs bash copyable" lang="bash">import { Element, render, <span class="hljs-built_in">set</span>Attr } from <span class="hljs-string">'./element'</span>;

<span class="hljs-built_in">let</span> allPatches;
<span class="hljs-built_in">let</span> index = 0;  // é»˜è®¤å“ªä¸ªéœ€è¦æ‰“è¡¥ä¸

<span class="hljs-keyword">function</span> patch(node, patches) {
    allPatches = patches;
    
    // ç»™æŸä¸ªå…ƒç´ æ‰“è¡¥ä¸
    walk(node);
}

<span class="hljs-keyword">function</span> walk(node) {
    <span class="hljs-built_in">let</span> current = allPatches[index++];
    <span class="hljs-built_in">let</span> childNodes = node.childNodes;

    // å…ˆåºæ·±åº¦ï¼Œç»§ç»­éå†é€’å½’å­èŠ‚ç‚¹
    childNodes.forEach(child =&gt; walk(child));

    <span class="hljs-keyword">if</span> (current) {
        <span class="hljs-keyword">do</span>Patch(node, current); // æ‰“ä¸Šè¡¥ä¸
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-keyword">do</span>Patch(node, patches) {
    // éå†æ‰€æœ‰æ‰“è¿‡çš„è¡¥ä¸
    patches.forEach(patch =&gt; {
        switch (patch.type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'ATTR'</span>:
                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> key <span class="hljs-keyword">in</span> patch.attr) {
                    <span class="hljs-built_in">let</span> value = patch.attr[key];
                    <span class="hljs-keyword">if</span> (value) {
                        <span class="hljs-built_in">set</span>Attr(node, key, value);
                    } <span class="hljs-keyword">else</span> {
                        node.removeAttribute(key);
                    }
                }
                <span class="hljs-built_in">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'TEXT'</span>:
                node.textContent = patch.text;
                <span class="hljs-built_in">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'REPLACE'</span>:
                <span class="hljs-built_in">let</span> newNode = patch.newNode;
                newNode = (newNode instanceof Element) ? render(newNode) : document.createTextNode(newNode);
                node.parentNode.replaceChild(newNode, node);
                <span class="hljs-built_in">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'REMOVE'</span>:
                node.parentNode.removeChild(node);
                <span class="hljs-built_in">break</span>;
            default:
                <span class="hljs-built_in">break</span>;
        }
    });
}

<span class="hljs-built_in">export</span> default patch;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>çœ‹å®Œä»£ç è¿˜éœ€è¦å†æ¥ç®€å•çš„åˆ†æä¸€ä¸‹</p>
<h3 class="heading" data-id="heading-10">patchåšäº†ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li>ç”¨ä¸€ä¸ªå˜é‡æ¥å¾—åˆ°ä¼ é€’è¿‡æ¥çš„æ‰€æœ‰è¡¥ä¸allPatches</li>
<li>patchæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°(node, patches)
<ul>
<li>åœ¨æ–¹æ³•å†…éƒ¨è°ƒç”¨walkæ–¹æ³•ï¼Œç»™æŸä¸ªå…ƒç´ æ‰“ä¸Šè¡¥ä¸</li>
</ul>
</li>
<li>walkæ–¹æ³•é‡Œè·å–æ‰€æœ‰çš„å­èŠ‚ç‚¹
<ul>
<li>ç»™å­èŠ‚ç‚¹ä¹Ÿè¿›è¡Œå…ˆåºæ·±åº¦ä¼˜å…ˆéå†ï¼Œé€’å½’walk</li>
<li>å¦‚æœå½“å‰çš„è¡¥ä¸æ˜¯å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå°±å¯¹å…¶æ‰“è¡¥ä¸(doPatch)</li>
</ul>
</li>
<li>doPatchæ‰“è¡¥ä¸æ–¹æ³•ä¼šæ ¹æ®ä¼ é€’çš„patchesè¿›è¡Œéå†
<ul>
<li>åˆ¤æ–­è¡¥ä¸çš„ç±»å‹æ¥è¿›è¡Œä¸åŒçš„æ“ä½œ
<ol>
<li>
<p>å±æ€§ATTR
for inå»éå†attrså¯¹è±¡ï¼Œå½“å‰çš„keyå€¼å¦‚æœå­˜åœ¨ï¼Œå°±ç›´æ¥è®¾ç½®å±æ€§setAttrï¼› å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„keyå€¼é‚£å°±ç›´æ¥åˆ é™¤è¿™ä¸ªkeyé”®çš„å±æ€§</p>
</li>
<li>
<p>æ–‡å­—TEXT
ç›´æ¥å°†è¡¥ä¸çš„textèµ‹å€¼ç»™nodeèŠ‚ç‚¹çš„textContentå³å¯</p>
</li>
<li>
<p>æ›¿æ¢REPLACE
æ–°èŠ‚ç‚¹æ›¿æ¢è€èŠ‚ç‚¹ï¼Œéœ€è¦å…ˆåˆ¤æ–­æ–°èŠ‚ç‚¹æ˜¯ä¸æ˜¯Elementçš„å®ä¾‹ï¼Œæ˜¯çš„è¯è°ƒç”¨renderæ–¹æ³•æ¸²æŸ“æ–°èŠ‚ç‚¹ï¼›</p>
<p>ä¸æ˜¯çš„è¯å°±è¡¨æ˜æ–°èŠ‚ç‚¹æ˜¯ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹å°±OKäº†ã€‚</p>
<p>ä¹‹åå†é€šè¿‡è°ƒç”¨çˆ¶çº§parentNodeçš„replaceChildæ–¹æ³•æ›¿æ¢ä¸ºæ–°çš„èŠ‚ç‚¹</p>
</li>
<li>
<p>åˆ é™¤REMOVE
ç›´æ¥è°ƒç”¨çˆ¶çº§çš„removeChildæ–¹æ³•åˆ é™¤è¯¥èŠ‚ç‚¹</p>
</li>
</ol>
</li>
</ul>
</li>
<li>å°†patchæ–¹æ³•é»˜è®¤å¯¼å‡ºæ–¹ä¾¿è°ƒç”¨</li>
</ul>
<p>å¥½äº†ï¼Œä¸€åˆ‡éƒ½å®‰é™ä¸‹æ¥äº†ã€‚è®©æˆ‘ä»¬å›å½’index.jsæ–‡ä»¶ä¸­ï¼Œå»è°ƒç”¨ä¸€ä¸‹diffå’Œpatchè¿™ä¸¤ä¸ªé‡è¦æ–¹æ³•ï¼Œçœ‹çœ‹å¥‡è¿¹ä¼šä¸ä¼šå‘ç”Ÿå§</p>
<h2 class="heading" data-id="heading-11">å›å½’</h2>
<pre><code class="hljs bash copyable" lang="bash">// index.js

import { createElement, render, renderDom } from <span class="hljs-string">'./element'</span>;
// +++ å¼•å…¥diffå’Œpatchæ–¹æ³•
import diff from <span class="hljs-string">'./diff'</span>;
import patch from <span class="hljs-string">'./patch'</span>;
// +++

<span class="hljs-built_in">let</span> virtualDom = createElement(<span class="hljs-string">'ul'</span>, {class: <span class="hljs-string">'list'</span>}, [
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'å‘¨æ°ä¼¦'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'æ—ä¿Šæ°'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'ç‹åŠ›å®'</span>])    
]);

<span class="hljs-built_in">let</span> el = render(virtualDom);
renderDom(el, window.root);

// +++
// åˆ›å»ºå¦ä¸€ä¸ªæ–°çš„è™šæ‹ŸDOM
<span class="hljs-built_in">let</span> virtualDom2 = createElement(<span class="hljs-string">'ul'</span>, {class: <span class="hljs-string">'list-group'</span>}, [
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item active'</span>}, [<span class="hljs-string">'ä¸ƒé‡Œé¦™'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'ä¸€åƒå¹´ä»¥å'</span>]),
    createElement(<span class="hljs-string">'li'</span>, {class: <span class="hljs-string">'item'</span>}, [<span class="hljs-string">'éœ€è¦äººé™ª'</span>])    
]);
// diffä¸€ä¸‹ä¸¤ä¸ªä¸åŒçš„è™šæ‹ŸDOM
<span class="hljs-built_in">let</span> patches = diff(virtualDom, virtualDom2);
console.log(patches);
// å°†å˜åŒ–æ‰“è¡¥ä¸ï¼Œæ›´æ–°åˆ°el
patch(el, patches);
// +++
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>å°†ä¿®æ”¹åçš„ä»£ç ä¿å­˜ï¼Œä¼šåœ¨æµè§ˆå™¨é‡Œçœ‹åˆ°DOMè¢«æ›´æ–°äº†ï¼Œå¦‚ä¸‹å›¾
</p><figure><img class="lazyload inited loaded" data-src="assets/1557109737-00752340242d78a207417e5ba861ca2d" data-width="1280" data-height="659" src="assets/1557109737-00752340242d78a207417e5ba861ca2d"><figcaption></figcaption></figure>
åˆ°è¿™é‡Œå°±finishäº†ï¼Œå†…å®¹æœ‰äº›å¤šï¼Œå¯èƒ½ä¸æ˜¯å¾ˆå¥½çš„æ¶ˆè€—ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå°±è®©æˆ‘ç”¨æœ€åå‡ å¥è¯æ¥æ€»ç»“ä¸€ä¸‹å®ç°çš„æ•´ä¸ªè¿‡ç¨‹å§<p></p>
<h2 class="heading" data-id="heading-12">å››å¥è¯</h2>
<p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹æ•´ä¸ª<strong>DOM-diff</strong>çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>ç”¨JSå¯¹è±¡æ¨¡æ‹ŸDOMï¼ˆè™šæ‹ŸDOMï¼‰</li>
<li>æŠŠæ­¤è™šæ‹ŸDOMè½¬æˆçœŸå®DOMå¹¶æ’å…¥é¡µé¢ä¸­ï¼ˆrenderï¼‰</li>
<li>å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿä¿®æ”¹äº†è™šæ‹ŸDOMï¼Œæ¯”è¾ƒä¸¤æ£µè™šæ‹ŸDOMæ ‘çš„å·®å¼‚ï¼Œå¾—åˆ°å·®å¼‚å¯¹è±¡ï¼ˆdiffï¼‰</li>
<li>æŠŠå·®å¼‚å¯¹è±¡åº”ç”¨åˆ°çœŸæ­£çš„DOMæ ‘ä¸Šï¼ˆpatchï¼‰</li>
</ol>
<p>è¡Œäº†ï¼Œå°±è¿™å››å¥è¯å§ï¼Œè¯´å¤šäº†å°±æœ‰ç‚¹ç”»è›‡æ·»è¶³äº†ã€‚å¥½ä¹…æ²¡æœ‰å†™æ–‡ç« äº†ï¼Œå¾ˆæ„Ÿè°¢å°ä¼™ä¼´ä»¬çš„è§‚çœ‹ï¼Œè¾›è‹¦å„ä½äº†ï¼Œ886</p>
<p><strong>å‚è€ƒï¼š</strong></p>
<p><a target="_blank" href="https://link.juejin.im/?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F31809713%2Fanswer%2F53544875" rel="nofollow noopener noreferrer">è™šæ‹ŸDOMå’ŒåŸç”Ÿè°æ›´å¿«ï¼Ÿ</a></p>
<p><a target="_blank" href="https://link.juejin.im/?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1I0glERv96CxaBmCvDSRo5g" rel="nofollow noopener noreferrer">ç å³° DOM-Diffç®—æ³•å­¦ä¹ -æå–ç ï¼šrtcu</a></p>
</div></article><div data-v-4a12c3f3="" data-v-4b868639="" class="tag-list-box"><div data-v-4a12c3f3="" data-v-4b868639="" class="tag-list-title">å…³æ³¨ä¸‹é¢çš„æ ‡ç­¾ï¼Œå‘ç°æ›´å¤šç›¸ä¼¼æ–‡ç« </div><div data-v-4a12c3f3="" data-v-4b868639="" st:block="tagList" class="tag-list"><a data-v-4a12c3f3="" href="https://juejin.im/tag/Vue.js" target="_blank" rel="" st:name="tag" class="item" data-v-4b868639=""><div data-v-acf63380="" data-v-21eddaa6="" data-v-4a12c3f3="" data-src="https://lc-gold-cdn.xitu.io/7b5c3eb591b671749fee.png?imageView2/2/w/42/h/42/q/85/format/webp/interlace/1" class="lazy thumb tag-icon loaded" style="background-image: url(&quot;https://lc-gold-cdn.xitu.io/7b5c3eb591b671749fee.png?imageView2/2/w/42/h/42/q/85/format/webp/interlace/1&quot;); background-size: contain;"></div><div data-v-4a12c3f3="" class="tag-title">Vue.js</div></a></div></div><a data-v-4a12c3f3="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" data-v-4b868639=""><div data-v-4a12c3f3="" class="footer-author-block"><div data-v-ac159f2a="" data-v-4a12c3f3="" itemscope="itemscope" itemtype="http://schema.org/Person" class="author"><div itemprop="memberOf" itemscope="itemscope" itemtype="http://schema.org/Organization"></div><div data-v-ac159f2a="" class="author-info-block"><a data-v-ac159f2a="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="avatar-link"><div data-v-acf63380="" data-v-37d9a154="" data-v-ac159f2a="" data-src="https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a><div data-v-ac159f2a="" class="author-info-box"><div data-v-ac159f2a="" class="profile-box"><a data-v-ac159f2a="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="username ellipsis">chenhongdong</a><span data-v-ac159f2a="" class="position ellipsis">å‰ç«¯å¼€å‘ @ 360</span></div><div data-v-ac159f2a="" class="meta-box"><a data-v-ac159f2a="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe/posts" target="_blank" rel="" class="posts"><span data-v-ac159f2a="" class="count post-count">å‘å¸ƒäº† 25 ç¯‡ä¸“æ  Â· </span></a><span data-v-ac159f2a="" class="count">è·å¾—ç‚¹èµ 12,408 Â· </span><span data-v-ac159f2a="" class="count">è·å¾—é˜…è¯» 215,532</span></div></div><button data-v-2fe230ac="" data-v-ac159f2a="" class="follow-button follow">å…³æ³¨</button></div></div></div></a><div data-v-4a12c3f3="" data-v-4b868639="" st:block="banner" class="article-banner"><a data-v-4a12c3f3="" data-v-4b868639="" st:name="link" st:state="https://juejin.im/extension/?utm_source=juejin.im&amp;utm_medium=post&amp;utm_campaign=extension_promotion" class="banner-title" href="https://juejin.im/extension/?utm_source=juejin.im&amp;utm_medium=post&amp;utm_campaign=extension_promotion" target="_blank">å®‰è£…æ˜é‡‘æµè§ˆå™¨æ’ä»¶</a><div data-v-4a12c3f3="" data-v-4b868639="" class="banner-content">æ‰“å¼€æ–°æ ‡ç­¾é¡µå‘ç°å¥½å†…å®¹ï¼Œæ˜é‡‘ã€GitHubã€Dribbbleã€ProductHunt ç­‰ç«™ç‚¹å†…å®¹è½»æ¾è·å–ã€‚å¿«æ¥å®‰è£…æ˜é‡‘æµè§ˆå™¨æ’ä»¶è·å–é«˜è´¨é‡å†…å®¹å§ï¼</div></div><!----><!----><div data-v-f227228a="" data-v-4a12c3f3="" class="comment-list-box" id="comment-box" data-v-4b868639="" manual="true"><div data-v-f227228a="" class="title">è¯„è®º</div><div data-v-ec19aada="" data-v-f227228a="" class="comment-form comment-form"><div data-v-ec19aada="" class="avatar-box"><div data-v-acf63380="" data-v-37d9a154="" data-v-ec19aada="" data-src="https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg&quot;);"></div></div><div data-v-ec19aada="" class="form-box"><div data-v-ec19aada="" class="input-box"><div data-v-ec19aada="" contenteditable="true" spellcheck="false" placeholder="è¾“å…¥è¯„è®º..." class="rich-input empty"><br data-v-ec19aada=""></div><!----></div><!----></div></div><div data-v-b15cf724="" data-v-f227228a="" class="comment-list comment-list"><div data-v-1090d892="" data-v-b15cf724="" class="image-viewer-box"><!----></div><div data-v-b15cf724="" class="item"><div data-v-7a3ef47a="" data-v-b15cf724="" class="comment comment"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="59fac8c7f265da431d3c047c" class="user-popover-box popover"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/59fac8c7f265da431d3c047c" target="_blank" rel="" class="user-link" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-7a3ef47a="" data-src="https://mirror-gold-cdn.xitu.io/168e08af8d0e0d2b803?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e08af8d0e0d2b803?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-7a3ef47a="" class="content-box comment-divider-line"><div data-v-7a3ef47a="" class="meta-box"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="59fac8c7f265da431d3c047c" class="user-popover-box"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/59fac8c7f265da431d3c047c" target="_blank" rel="" class="username ellipsis" data-v-6e26702a="">å‰ç«¯å°ç„¶å­<!----></a></div><div data-v-7a3ef47a="" class="position">å‰ç«¯ç ”å‘å·¥ç¨‹å¸ˆ @ ä¸­å›½æ³•é™¢ç½‘</div></div><div data-v-7a3ef47a="" class="content">ç®€å•æ˜“æ‡‚ï¼Œåˆæ­¥è®²è§£äº†domdiffçš„å®ç°åŸç†ï¼Œ   åç»­çš„ä¼˜åŒ–ä¸»è¦åœ¨diffç®—æ³•ä¸Šï¼Œå°½å¯èƒ½çš„å‡å°‘é‡ç»˜é‡æ’ä»¥åŠä¼˜åŒ–æ£€ç´¢éå†æ—¶é—´<img class="emoji" draggable="false" alt="ğŸ˜" src="assets/1557109737-a87f1abd4bef64a72c9e480b89d3337e.svg">
è¿™ä¸ªç”¨æ¥åšdiffå…¥é—¨è¿˜æ˜¯ä¸€ç‚¹æ¯›ç—…æ²¡æœ‰ï¼Œå–œæ¬¢ä½ çš„ä¸€å¥è¯"æˆ‘ä»¬è™½ç„¶èµ°çš„æ…¢ï¼Œä½†æ˜¯å´ä»æœªåœä¸‹è„šæ­¥"<img class="emoji" draggable="false" alt="ğŸ‘" src="assets/1557109737-bf46c6b0ae409670e3cbe1af9e125d25.svg"></div><div data-v-7a3ef47a="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-7a3ef47a="" class="reply-stat"><time data-v-7a3ef47a="" datetime="2019-04-26T14:22:07.633Z" title="Fri Apr 26 2019 22:22:07 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">9å¤©å‰</time><div data-v-7a3ef47a="" class="action-box"><div data-v-7a3ef47a="" class="like-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-7a3ef47a="" class="comment-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-7a3ef47a="" class="action-title">å›å¤</span></div></div></div><!----><div data-v-7eda734a="" data-v-7a3ef47a="" class="sub-comment-list sub-comment-list"><div data-v-7eda734a="" class="item"><div data-v-0ce14c07="" data-v-7eda734a="" class="sub-comment sub-comment"><div data-v-0ce14c07="" class="sub-comment-content-row"><div data-v-0ce14c07="" class="sub-comment-content-box"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="585b9ec961ff4b0063e76dbe" class="user-popover-box popover"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="username" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-0ce14c07="" data-src="https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-0ce14c07="" class="user-content-box"><div data-v-0ce14c07="" class="profie"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="585b9ec961ff4b0063e76dbe" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="username" data-v-6e26702a="">chenhongdong<span data-v-0ce14c07="" class="author-badge-text">(ä½œè€…)</span></a></div><div data-v-0ce14c07="" class="position">å‰ç«¯å¼€å‘ @ 360</div></div><div data-v-0ce14c07="" class="content-box"><span data-v-0ce14c07=""> å›å¤ </span><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="59fac8c7f265da431d3c047c" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/59fac8c7f265da431d3c047c" target="_blank" rel="" class="username be-replied" data-v-6e26702a="">å‰ç«¯å°ç„¶å­</a></div><!----><span data-v-0ce14c07="">: </span><span data-v-0ce14c07="" class="content">æ˜¯å•Šï¼Œéƒ½ä¸è¦åœä¸‹å‰ç«¯å­¦ä¹ çš„è„šæ­¥,fighting</span></div><!----><!----><div data-v-0ce14c07="" class="limit-all-box"><!----></div><div data-v-0ce14c07="" class="sub-comment-stat-box"><time data-v-0ce14c07="" datetime="2019-04-28T06:44:25.760Z" title="Sun Apr 28 2019 14:44:25 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">7å¤©å‰</time><div data-v-0ce14c07="" class="sub-comment-action-box"><div data-v-0ce14c07="" class="like-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-0ce14c07="" class="comment-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-0ce14c07="">å›å¤</span></div></div></div><!----></div></div></div><!----></div></div><!----></div></div><!----></div></div><div data-v-b15cf724="" class="item"><div data-v-7a3ef47a="" data-v-b15cf724="" class="comment comment"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="5870f229ac502e00645925a7" class="user-popover-box popover"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/5870f229ac502e00645925a7" target="_blank" rel="" class="user-link" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-7a3ef47a="" data-src="https://user-gold-cdn.xitu.io/2019/4/16/16a2534ebdbbc874?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2019/4/16/16a2534ebdbbc874?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-7a3ef47a="" class="content-box comment-divider-line"><div data-v-7a3ef47a="" class="meta-box"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="5870f229ac502e00645925a7" class="user-popover-box"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/5870f229ac502e00645925a7" target="_blank" rel="" class="username ellipsis" data-v-6e26702a="">æœªæ¥1483797033519<!----></a></div><div data-v-7a3ef47a="" class="position">å…¨æ ˆå·¥ç¨‹å¸ˆ</div></div><div data-v-7a3ef47a="" class="content">å¤ªå‰å®³äº†</div><div data-v-7a3ef47a="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-7a3ef47a="" class="reply-stat"><time data-v-7a3ef47a="" datetime="2019-04-16T08:31:43.422Z" title="Tue Apr 16 2019 16:31:43 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">19å¤©å‰</time><div data-v-7a3ef47a="" class="action-box"><div data-v-7a3ef47a="" class="like-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-7a3ef47a="" class="comment-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-7a3ef47a="" class="action-title">å›å¤</span></div></div></div><!----><div data-v-7eda734a="" data-v-7a3ef47a="" class="sub-comment-list sub-comment-list"><div data-v-7eda734a="" class="item"><div data-v-0ce14c07="" data-v-7eda734a="" class="sub-comment sub-comment"><div data-v-0ce14c07="" class="sub-comment-content-row"><div data-v-0ce14c07="" class="sub-comment-content-box"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="585b9ec961ff4b0063e76dbe" class="user-popover-box popover"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="username" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-0ce14c07="" data-src="https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/168e083b4551b770de1?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-0ce14c07="" class="user-content-box"><div data-v-0ce14c07="" class="profie"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="585b9ec961ff4b0063e76dbe" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/585b9ec961ff4b0063e76dbe" target="_blank" rel="" class="username" data-v-6e26702a="">chenhongdong<span data-v-0ce14c07="" class="author-badge-text">(ä½œè€…)</span></a></div><div data-v-0ce14c07="" class="position">å‰ç«¯å¼€å‘ @ 360</div></div><div data-v-0ce14c07="" class="content-box"><span data-v-0ce14c07=""> å›å¤ </span><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="5870f229ac502e00645925a7" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/5870f229ac502e00645925a7" target="_blank" rel="" class="username be-replied" data-v-6e26702a="">æœªæ¥1483797033519</a></div><!----><span data-v-0ce14c07="">: </span><span data-v-0ce14c07="" class="content"><img class="emoji" draggable="false" alt="ğŸ‘" src="assets/1557109737-c4adc4953dc797f2c5949ce9e1189d49.svg"></span></div><!----><!----><div data-v-0ce14c07="" class="limit-all-box"><!----></div><div data-v-0ce14c07="" class="sub-comment-stat-box"><time data-v-0ce14c07="" datetime="2019-04-17T03:06:39.870Z" title="Wed Apr 17 2019 11:06:39 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">18å¤©å‰</time><div data-v-0ce14c07="" class="sub-comment-action-box"><div data-v-0ce14c07="" class="like-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-0ce14c07="" class="comment-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-0ce14c07="">å›å¤</span></div></div></div><!----></div></div></div><!----></div></div><!----></div></div><!----></div></div><div data-v-b15cf724="" class="item"><div data-v-7a3ef47a="" data-v-b15cf724="" class="comment comment"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="5b6dafa75188251b134ea751" class="user-popover-box popover"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/5b6dafa75188251b134ea751" target="_blank" rel="" class="user-link" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-7a3ef47a="" data-src="https://user-gold-cdn.xitu.io/2018/8/12/1652d0c5f55b84b0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://user-gold-cdn.xitu.io/2018/8/12/1652d0c5f55b84b0?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div></a></div><div data-v-7a3ef47a="" class="content-box comment-divider-line"><div data-v-7a3ef47a="" class="meta-box"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="5b6dafa75188251b134ea751" class="user-popover-box"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/5b6dafa75188251b134ea751" target="_blank" rel="" class="username ellipsis" data-v-6e26702a="">ccccccccc<!----></a></div><div data-v-7a3ef47a="" class="position">å‰ç«¯ @ åˆ’æ°´å…¬å¸</div></div><div data-v-7a3ef47a="" class="content">çœ‹äº†è§†é¢‘åˆæ¥çœ‹æºç ï¼Œè¿˜æ˜¯ä¸æ˜¯å¾ˆæ‡‚ä¸ºä»€ä¹ˆdiffchildé‚£è¾¹ä¸èƒ½ç›´æ¥ä¼ indexè€Œä¸”åˆå®šä¹‰äº†ä¸ªé—­åŒ…numæ¥è®°å½•ï¼Œä¸ºä»€ä¹ˆç©¿indexä¼šæ‹¿åˆ°çš„ä¼šå˜æˆ4è€Œnumå°±æ˜¯æ­£å¸¸çš„6</div><div data-v-7a3ef47a="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-7a3ef47a="" class="reply-stat"><time data-v-7a3ef47a="" datetime="2019-04-10T15:51:53.774Z" title="Wed Apr 10 2019 23:51:53 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">25å¤©å‰</time><div data-v-7a3ef47a="" class="action-box"><div data-v-7a3ef47a="" class="like-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-7a3ef47a="" class="comment-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-7a3ef47a="" class="action-title">å›å¤</span></div></div></div><!----><div data-v-7eda734a="" data-v-7a3ef47a="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div><div data-v-b15cf724="" class="item"><div data-v-7a3ef47a="" data-v-b15cf724="" class="comment comment"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="58ebcfecac502e4957d0083f" class="user-popover-box popover"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/58ebcfecac502e4957d0083f" target="_blank" rel="" class="user-link" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-7a3ef47a="" data-src="https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://b-gold-cdn.xitu.io/v3/static/img/default-avatar.e30559a.svg&quot;);"></div></a></div><div data-v-7a3ef47a="" class="content-box comment-divider-line"><div data-v-7a3ef47a="" class="meta-box"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="58ebcfecac502e4957d0083f" class="user-popover-box"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/58ebcfecac502e4957d0083f" target="_blank" rel="" class="username ellipsis" data-v-6e26702a="">çˆ±å®¢<!----></a></div><div data-v-7a3ef47a="" class="position"></div></div><div data-v-7a3ef47a="" class="content">å¾ˆä¸é”™ï¼Œæ„Ÿè°¢~
ä¸è¿‡ï¼Œåœ¨diffæ—¶ä½¿ç”¨çš„æ˜¯å…ˆåºæ·±åº¦ä¼˜å…ˆéå†ï¼Œè€Œåœ¨patchæ—¶ä½¿ç”¨çš„æ˜¯ååºæ·±åº¦ä¼˜å…ˆéå†ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜â€”â€”æ¯”å¦‚æŸä¸ªèŠ‚ç‚¹è¢«æ›¿æ¢äº†ï¼Œä½†æ˜¯å®ƒçš„å­èŠ‚ç‚¹åœ¨patchæ—¶ä½¿ç”¨ååºæ·±åº¦ä¼˜å…ˆéå†ä»ç„¶ä¼šåˆ†é…ä¸€ä¸ªindexï¼Œè€Œè¿™åœ¨å…ˆåºæ·±åº¦ä¼˜å…ˆéå†æ—¶æ˜¯ä¸ä¼šå‘ç”Ÿçš„ï¼›æ•…å¯¼è‡´äº†ä¸¤ç§éå†æ–¹å¼åœ¨diffå’Œpatchçš„æ—¶å€™å¯èƒ½åˆ†é…åˆ°ä¸åŒçš„indexï¼Œä»è€Œå¯¼è‡´patchå‡ºç°å‡ºä¹æ„æ–™çš„ç»“æœ</div><div data-v-7a3ef47a="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-7a3ef47a="" class="reply-stat"><time data-v-7a3ef47a="" datetime="2019-04-08T14:48:04.786Z" title="Mon Apr 08 2019 22:48:04 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">27å¤©å‰</time><div data-v-7a3ef47a="" class="action-box"><div data-v-7a3ef47a="" class="like-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><span data-v-7a3ef47a="" class="action-title">2</span></div><div data-v-7a3ef47a="" class="comment-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-7a3ef47a="" class="action-title">å›å¤</span></div></div></div><!----><div data-v-7eda734a="" data-v-7a3ef47a="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div><div data-v-b15cf724="" class="item"><div data-v-7a3ef47a="" data-v-b15cf724="" class="comment comment"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="58ba193bac502e006bebd999" class="user-popover-box popover"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/58ba193bac502e006bebd999" target="_blank" rel="" class="user-link" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-7a3ef47a="" data-src="https://mirror-gold-cdn.xitu.io/168e0843c54ae2bafff?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar" style="background-image: none;"></div></a></div><div data-v-7a3ef47a="" class="content-box comment-divider-line"><div data-v-7a3ef47a="" class="meta-box"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="58ba193bac502e006bebd999" class="user-popover-box"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/58ba193bac502e006bebd999" target="_blank" rel="" class="username ellipsis" data-v-6e26702a="">w2cc<!----></a></div><div data-v-7a3ef47a="" class="position"></div></div><div data-v-7a3ef47a="" class="content">æˆ‘æœ‰ä¸ªç–‘é—® åœ¨diff.js æ–‡ä»¶ä¸­ï¼Œ diffChildren æ–¹æ³•ä¸Šé¢ å®šä¹‰äº†ä¸€ä¸ª let num = 0 è²Œä¼¼è¿™ä¸ªnumæœ‰å®‰å…¨é—®é¢˜å§ï¼Œæ¯æ¬¡éƒ½++ï¼›ä¸‡ä¸€å†…å­˜æº¢å‡ºäº†æ€ä¹ˆåŠã€‚</div><div data-v-7a3ef47a="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-7a3ef47a="" class="reply-stat"><time data-v-7a3ef47a="" datetime="2019-04-01T04:19:53.081Z" title="Mon Apr 01 2019 12:19:53 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">1æœˆå‰</time><div data-v-7a3ef47a="" class="action-box"><div data-v-7a3ef47a="" class="like-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-7a3ef47a="" class="comment-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-7a3ef47a="" class="action-title">å›å¤</span></div></div></div><!----><div data-v-7eda734a="" data-v-7a3ef47a="" class="sub-comment-list sub-comment-list"><!----></div></div><!----></div></div><div data-v-b15cf724="" class="item"><div data-v-7a3ef47a="" data-v-b15cf724="" class="comment comment"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="5c09e657518825371057ff40" class="user-popover-box popover"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/5c09e657518825371057ff40" target="_blank" rel="" class="user-link" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-7a3ef47a="" data-src="https://mirror-gold-cdn.xitu.io/168e096f09aa3eb5bdd?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar" style="background-image: none;"></div></a></div><div data-v-7a3ef47a="" class="content-box comment-divider-line"><div data-v-7a3ef47a="" class="meta-box"><div data-v-6e26702a="" data-v-7a3ef47a="" st:block="userPopover" st:state="5c09e657518825371057ff40" class="user-popover-box"><!----><a data-v-7a3ef47a="" href="https://juejin.im/user/5c09e657518825371057ff40" target="_blank" rel="" class="username ellipsis" data-v-6e26702a="">anthinkingcoder<!----></a></div><div data-v-7a3ef47a="" class="position">å‰ç«¯å·¥ç¨‹å¸ˆ @ 3vjia</div></div><div data-v-7a3ef47a="" class="content">è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼ŒdiffChildren(oldChildren, newChildren, patches)å‡½æ•°é‡Œï¼Œå¦‚æœoldChildrençš„é•¿åº¦length1å°äºnewChildrençš„é•¿åº¦length2ï¼Œé‚£ä¹ˆnewChildren[length1 -1]ï½newChildren[length2- 1]çš„å…ƒç´ æ˜¯æ²¡åŠæ³•ç”Ÿæˆæ–°å¢è¡¥ä¸çš„å§ã€‚</div><div data-v-7a3ef47a="" class="limit-ctl-box"><!----><!----></div><!----><div data-v-7a3ef47a="" class="reply-stat"><time data-v-7a3ef47a="" datetime="2019-03-31T11:12:22.654Z" title="Sun Mar 31 2019 19:12:22 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">1æœˆå‰</time><div data-v-7a3ef47a="" class="action-box"><div data-v-7a3ef47a="" class="like-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><span data-v-7a3ef47a="" class="action-title">1</span></div><div data-v-7a3ef47a="" class="comment-action action"><svg data-v-7a3ef47a="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-7a3ef47a="" fill="none" fill-rule="evenodd"><path data-v-7a3ef47a="" d="M0 0h20v20H0z"></path> <path data-v-7a3ef47a="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-7a3ef47a="" class="action-title">å›å¤</span></div></div></div><!----><div data-v-7eda734a="" data-v-7a3ef47a="" class="sub-comment-list sub-comment-list"><div data-v-7eda734a="" class="item"><div data-v-0ce14c07="" data-v-7eda734a="" class="sub-comment sub-comment"><div data-v-0ce14c07="" class="sub-comment-content-row"><div data-v-0ce14c07="" class="sub-comment-content-box"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="5c09e657518825371057ff40" class="user-popover-box popover"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/5c09e657518825371057ff40" target="_blank" rel="" class="username" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-0ce14c07="" data-src="https://mirror-gold-cdn.xitu.io/168e096f09aa3eb5bdd?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar" style="background-image: none;"></div></a></div><div data-v-0ce14c07="" class="user-content-box"><div data-v-0ce14c07="" class="profie"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="5c09e657518825371057ff40" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/5c09e657518825371057ff40" target="_blank" rel="" class="username" data-v-6e26702a="">anthinkingcoder<!----></a></div><div data-v-0ce14c07="" class="position">å‰ç«¯å·¥ç¨‹å¸ˆ @ 3vjia</div></div><div data-v-0ce14c07="" class="content-box"><span data-v-0ce14c07=""> å›å¤ </span><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="5c09e657518825371057ff40" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/5c09e657518825371057ff40" target="_blank" rel="" class="username be-replied" data-v-6e26702a="">anthinkingcoder</a></div><!----><span data-v-0ce14c07="">: </span><span data-v-0ce14c07="" class="content">è€Œä¸”walkå‡½æ•°é‡Œè™½ç„¶æœ‰oldNodeä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºä¸ºæ–°å¢è¡¥ä¸çš„ä»£ç ã€‚ä½†oldNodeä¸å¯èƒ½ä¸ºç©ºå‘€ï¼Œè€Œä¸”åˆ¤æ–­oldNodeä¸ºç©ºçš„æ—¶æœºåº”è¯¥åœ¨oldNode.type === newNode.typeçš„æ¡ä»¶å‰å§ã€‚</span></div><!----><!----><div data-v-0ce14c07="" class="limit-all-box"><!----></div><div data-v-0ce14c07="" class="sub-comment-stat-box"><time data-v-0ce14c07="" datetime="2019-03-31T11:17:30.226Z" title="Sun Mar 31 2019 19:17:30 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">1æœˆå‰</time><div data-v-0ce14c07="" class="sub-comment-action-box"><div data-v-0ce14c07="" class="like-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-0ce14c07="" class="comment-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-0ce14c07="">å›å¤</span></div></div></div><!----></div></div></div><!----></div></div><div data-v-7eda734a="" class="item"><div data-v-0ce14c07="" data-v-7eda734a="" class="sub-comment sub-comment"><div data-v-0ce14c07="" class="sub-comment-content-row"><div data-v-0ce14c07="" class="sub-comment-content-box"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="58ba193bac502e006bebd999" class="user-popover-box popover"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/58ba193bac502e006bebd999" target="_blank" rel="" class="username" data-v-6e26702a=""><div data-v-acf63380="" data-v-37d9a154="" data-v-0ce14c07="" data-src="https://mirror-gold-cdn.xitu.io/168e0843c54ae2bafff?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar" style="background-image: none;"></div></a></div><div data-v-0ce14c07="" class="user-content-box"><div data-v-0ce14c07="" class="profie"><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="58ba193bac502e006bebd999" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/58ba193bac502e006bebd999" target="_blank" rel="" class="username" data-v-6e26702a="">w2cc<!----></a></div><div data-v-0ce14c07="" class="position"></div></div><div data-v-0ce14c07="" class="content-box"><span data-v-0ce14c07=""> å›å¤ </span><div data-v-6e26702a="" data-v-0ce14c07="" st:block="userPopover" st:state="5c09e657518825371057ff40" class="user-popover-box"><!----><a data-v-0ce14c07="" href="https://juejin.im/user/5c09e657518825371057ff40" target="_blank" rel="" class="username be-replied" data-v-6e26702a="">anthinkingcoder</a></div><!----><span data-v-0ce14c07="">: </span><span data-v-0ce14c07="" class="content">æˆ‘ä¹Ÿå‘ç°äº†å½“newChildrenæ¯”oldChildrenå¤šçš„æ—¶å€™ï¼Œæ— æ³•æ›´æ–°ä¸Šå»ã€‚ä¸çŸ¥é“reactæºç æ€ä¹ˆå®ç°çš„</span></div><!----><!----><div data-v-0ce14c07="" class="limit-all-box"><!----></div><div data-v-0ce14c07="" class="sub-comment-stat-box"><time data-v-0ce14c07="" datetime="2019-04-02T05:16:44.396Z" title="Tue Apr 02 2019 13:16:44 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)" class="time">1æœˆå‰</time><div data-v-0ce14c07="" class="sub-comment-action-box"><div data-v-0ce14c07="" class="like-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon like-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z"></path></g></svg><!----></div><div data-v-0ce14c07="" class="comment-action action"><svg data-v-0ce14c07="" aria-hidden="true" width="16" height="16" viewBox="0 0 20 20" class="icon comment-icon"><g data-v-0ce14c07="" fill="none" fill-rule="evenodd"><path data-v-0ce14c07="" d="M0 0h20v20H0z"></path> <path data-v-0ce14c07="" stroke="#8A93A0" stroke-linejoin="round" d="M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z"></path></g></svg> <span data-v-0ce14c07="">å›å¤</span></div></div></div><!----></div></div></div><!----></div></div><!----></div></div><!----></div></div></div><div data-v-f227228a="" class="fetch-more-comment">æŸ¥çœ‹æ›´å¤š &gt;</div></div></div></DIV></MAIN></DIV></DIV>
      
        <hr />
        <!-- clipping information -->
        <div class="clipping-information">
          <label>åŸç½‘å€: <a href="https://juejin.im/post/5c8e5e4951882545c109ae9c" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">è®¿é—®</a></label><br />
          <label>åˆ›å»ºäº: 2019-05-06 10:28:57</label><br />
          <label>ç›®å½•: default</label><br />
          <label>æ ‡ç­¾: æ— </label>
        </div>
    </div>
  </body>
</html>